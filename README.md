# 树莓派私有云存储系统 (RaspberryCloud)

完整的私有云存储解决方案，功能对标百度网盘，专为树莓派优化。

## 📋 方案概述

### 系统架构

```
用户设备（电脑/手机）
    ↓ HTTPS
Nginx 反向代理 (端口80/443)
    ↓
FastAPI 后端服务 (端口8000)
    ↓
├── SQLite/MariaDB (用户信息、文件元数据)
└── SD卡/外接存储 (实际文件存储)
```

### 核心特性

- ✅ 文件上传/下载（支持断点续传，单文件最大10GB+）
- ✅ 文件管理（新建、删除、重命名、移动、搜索）
- ✅ 在线预览（图片、PDF、视频、音频）
- ✅ 多用户系统（管理员/普通用户，配额管理）
- ✅ 文件分享（链接+提取码，可设置有效期）
- ✅ 多端访问（Web端、局域网磁盘挂载、外网访问）
- ✅ 自动同步（多设备增量同步）
- ✅ 安全加固（HTTPS、密码哈希、防火墙）

### 硬件要求

| 组件 | 最低要求 | 推荐配置 | SD卡方案（您的情况） |
|------|---------|---------|---------------------|
| 树莓派型号 | 树莓派4B 2GB | 树莓派5 8GB | **树莓派5 8GB** ✅ |
| 存储方案 | 外接USB硬盘 | 外接USB硬盘 | **SD卡64GB** ✅ |
| 电源 | 5V/3A USB-C | 5V/5A USB-C | 5V/3A USB-C ✅ |
| SD卡 | Class 10 ≥32GB | UHS-I ≥64GB | **UHS-I 64GB** ✅ |
| 网络 | 有线/无线 | 千兆有线网络 | 千兆有线网络 |

**存储方案说明**：

**方案A：SD卡存储（适合64GB SD卡）** ⭐ **推荐您使用此方案**
- ✅ 无需外接设备，即插即用
- ✅ 适合个人使用，存储容量约50GB（系统占用10GB）
- ✅ 推荐单用户配额20-30GB
- ⚠️ 注意：SD卡读写寿命有限，建议定期备份
- 📖 详细配置见：[SD卡存储方案配置](docs/00-SD卡存储方案配置.md)

**方案B：外接硬盘存储（适合大容量需求）**
- 格式：ext4（推荐）、NTFS（兼容Windows）、exFAT
- 接口：USB 3.0以上（读写速度≥100MB/s）
- 可选RAID：支持2块硬盘组RAID1镜像（需USB Hub）

### 资源占用（实测）

- 内存占用：空闲时 ~80MB，单用户上传时 ~150MB（**8GB内存完全够用**）
- CPU占用：空闲时 <5%，文件传输时 15-30%
- 存储占用：
  - 系统文件：~10GB（Raspberry Pi OS + 应用）
  - 数据库：<100MB
  - 用户数据：剩余空间（**64GB SD卡约50GB可用**）

## 📦 项目结构

```
私有云存储系统/
├── README.md                    # 本文件
├── docs/                        # 文档目录
│   ├── 00-SD卡存储方案配置.md   # SD卡存储专用配置 ⭐
│   ├── 01-硬件准备与初始化.md
│   ├── 02-系统部署教程.md
│   ├── 03-多端访问配置.md
│   ├── 04-安全加固指南.md
│   └── 05-问题排查手册.md
├── backend/                     # 后端代码
│   ├── main.py                 # FastAPI主程序
│   ├── models.py               # 数据库模型
│   ├── auth.py                 # 认证模块
│   ├── file_handler.py         # 文件处理模块
│   ├── share.py                # 分享模块
│   ├── config.py               # 配置文件
│   ├── requirements.txt        # Python依赖
│   └── database.sql            # 数据库初始化脚本
├── frontend/                    # 前端代码
│   ├── index.html              # 主页面
│   ├── login.html              # 登录页面
│   ├── css/
│   │   └── style.css
│   └── js/
│       ├── main.js
│       ├── upload.js
│       └── preview.js
├── config/                      # 配置文件
│   ├── env.example             # 环境变量示例
│   ├── nginx.conf              # Nginx配置
│   └── raspberrycloud.service  # systemd服务
└── scripts/                     # 部署脚本
    ├── install.sh              # 一键安装脚本
    ├── backup.sh               # 自动备份
    ├── mount_storage.sh        # 存储挂载（外接硬盘用）
    └── update.sh               # 系统更新
```

## 🚀 快速开始（SD卡方案）

### 一键安装（推荐）

```bash
cd RaspiOwnCloud
sudo bash scripts/install.sh

# 安装时会询问存储方案，选择 "sd"（SD卡存储）
```

### 手动安装

按照文档步骤操作：
1. [SD卡存储方案配置](docs/00-SD卡存储方案配置.md) ⭐ **先看这个**
2. [硬件准备与初始化](docs/01-硬件准备与初始化.md) - 跳过外接硬盘部分
3. [系统部署教程](docs/02-系统部署教程.md)
4. [手动部署命令](docs/手动部署命令.md) - 详细的命令列表

## 🏃 运行项目

### 生产环境（树莓派）

```bash
# 启动服务
sudo systemctl start raspberrycloud

# 查看状态
sudo systemctl status raspberrycloud

# 访问Web界面
# 浏览器打开: http://树莓派IP
```

### 开发环境（本地Windows）

```powershell
# 使用启动脚本
.\scripts\start.bat

# 或手动启动
cd backend
.\venv\Scripts\activate
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

详细运行指南：[项目运行指南](docs/项目运行指南.md)

## 📱 访问方式

- **局域网Web访问**：http://树莓派IP
- **外网访问**：https://你的域名.com
- **局域网磁盘挂载**：\\树莓派IP\cloud (Windows) 或 smb://树莓派IP/cloud (Mac/Linux)

## 🔐 默认账户

- 管理员账号：admin
- 默认密码：RaspberryCloud2024!
- ⚠️ **首次登录后立即修改密码！**

## 📊 性能基准

基于树莓派5测试：
- 上传速度：局域网 ~90MB/s，外网受限于上行带宽
- 下载速度：局域网 ~110MB/s，外网受限于下行带宽
- 并发用户：建议≤10人同时使用
- 存储容量：
  - **SD卡方案：约50GB可用（64GB SD卡）**
  - 外接硬盘方案：受限于硬盘大小

## 🛠️ 技术栈

- **操作系统**：Raspberry Pi OS 64位 (Bookworm)
- **后端框架**：FastAPI (Python 3.11+)
- **数据库**：SQLite (≤3用户) / MariaDB (3+用户)
- **Web服务器**：Nginx
- **前端**：原生HTML/CSS/JS（无框架依赖）
- **文件系统**：Samba (局域网共享)
- **安全**：Let's Encrypt (HTTPS证书)

## 📚 文档导航

- [SD卡存储方案配置](docs/00-SD卡存储方案配置.md) ⭐ **SD卡用户必读**
- [硬件准备与初始化](docs/01-硬件准备与初始化.md) - 树莓派系统烧录、初始配置
- [系统部署教程](docs/02-系统部署教程.md) - 后端/前端/数据库/Nginx完整部署
- [多端访问配置](docs/03-多端访问配置.md) - 局域网/外网/移动端访问设置
- [安全加固指南](docs/04-安全加固指南.md) - HTTPS、防火墙、权限配置
- [问题排查手册](docs/05-问题排查手册.md) - 常见问题及解决方案

## 💡 SD卡方案特别提示

### 存储空间分配建议

```
64GB SD卡总容量
├── 系统占用：~10GB
└── 数据存储：~50GB
    ├── 用户文件：~40GB
    ├── 分享文件：~5GB
    ├── 临时文件：~2GB
    └── 备份文件：~3GB
```

### 用户配额建议

- **个人使用**：20-30GB
- **家庭使用**：10-15GB/人（3-4人共享）
- **测试环境**：5GB

### 重要注意事项

1. ⚠️ **定期备份**：SD卡可能损坏，重要数据请备份到其他设备
2. ⚠️ **空间管理**：定期清理临时文件和旧备份
3. ⚠️ **写入寿命**：减少不必要的日志写入，延长SD卡寿命

## 🔄 更新日志

- **v1.0.1** (2024-12) - 添加SD卡存储方案支持
- **v1.0.0** (2024-12) - 初始版本发布

## 📄 开源协议

MIT License

## 🙋 技术支持

遇到问题？查看[问题排查手册](docs/05-问题排查手册.md)或提交Issue。
