# åˆ†äº«åŠŸèƒ½ä¿®å¤ - åŒæ–‡ä»¶å¤¹æ›´æ–°æŒ‡å—

## ğŸ“ åŒæ–‡ä»¶å¤¹æ¶æ„è¯´æ˜

ä½ çš„ç³»ç»Ÿä½¿ç”¨åŒæ–‡ä»¶å¤¹éƒ¨ç½²ï¼š

| æ–‡ä»¶å¤¹ | è·¯å¾„ | ç”¨é€” |
|--------|------|------|
| **æ›´æ–°æ–‡ä»¶å¤¹** | Windows: `F:\Github\RaspiOwnCloud`<br>æ ‘è“æ´¾: `~/Desktop/Github/RaspiOwnCloud` | Gitæ“ä½œã€ä»£ç å¼€å‘ |
| **ç”Ÿäº§æ–‡ä»¶å¤¹** | `/opt/raspberrycloud/` | æœåŠ¡å®é™…è¿è¡Œ |

## ğŸ”„ åˆšåˆšçš„ä¿®æ”¹å†…å®¹

### æ–°å¢æ–‡ä»¶
- âœ… `frontend/share.html` - åˆ†äº«é¡µé¢
- âœ… `frontend/js/share.js` - åˆ†äº«é€»è¾‘
- âœ… `åˆ†äº«åŠŸèƒ½ä¿®å¤è¯´æ˜.md` - æ–‡æ¡£
- âœ… `å¿«é€Ÿæµ‹è¯•-åˆ†äº«åŠŸèƒ½.md` - æµ‹è¯•æŒ‡å—
- âœ… `åˆ†äº«åŠŸèƒ½-åŒæ–‡ä»¶å¤¹æ›´æ–°æŒ‡å—.md` - æœ¬æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
- âœ… `backend/main.py` - æ·»åŠ é™æ€æ–‡ä»¶è·¯ç”±

## ğŸš€ æ›´æ–°æ­¥éª¤ï¼ˆ3ç§æ–¹å¼ï¼‰

### æ–¹æ¡ˆAï¼šåœ¨æ ‘è“æ´¾ä¸Šç›´æ¥ä¿®æ”¹ï¼ˆæ¨èï¼‰â­

å¦‚æœä½ å¯ä»¥SSHåˆ°æ ‘è“æ´¾ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼š

```bash
# 1. SSHç™»å½•æ ‘è“æ´¾
ssh pi@raspberrypi.local

# 2. è¿›å…¥æ›´æ–°æ–‡ä»¶å¤¹
cd ~/Desktop/Github/RaspiOwnCloud

# 3. æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä»£ç åœ¨GitHubä¸Šï¼‰
git pull origin main

# 4. æˆ–è€…æ‰‹åŠ¨åˆ›å»º/ä¿®æ”¹æ–‡ä»¶
# æŒ‰ç…§ä¸‹é¢"æ‰‹åŠ¨æ›´æ–°æ–‡ä»¶"éƒ¨åˆ†æ“ä½œ

# 5. å¿«é€Ÿéƒ¨ç½²åˆ°ç”Ÿäº§æ–‡ä»¶å¤¹
bash scripts/quick_update.sh

# 6. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status raspberrycloud

# 7. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
sudo journalctl -u raspberrycloud -n 30 -f
```

**å¦‚æœå¿«é€Ÿéƒ¨ç½²è„šæœ¬éœ€è¦sudoæƒé™**ï¼š
```bash
sudo bash scripts/quick_update.sh
```

---

### æ–¹æ¡ˆBï¼šä»Windowsæäº¤åˆ°GitHub

å¦‚æœä½ å·²ç»åœ¨ Windows çš„ `F:\Github\RaspiOwnCloud` ä¿®æ”¹äº†ä»£ç ï¼š

#### Step 1: Windowsä¸Šæäº¤ä»£ç 

```powershell
# åœ¨ PowerShell ä¸­æ‰§è¡Œï¼ˆWindowsï¼‰
cd F:\Github\RaspiOwnCloud

# æŸ¥çœ‹ä¿®æ”¹çš„æ–‡ä»¶
git status

# æ·»åŠ æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶
git add frontend/share.html
git add frontend/js/share.js
git add backend/main.py
git add åˆ†äº«åŠŸèƒ½ä¿®å¤è¯´æ˜.md
git add å¿«é€Ÿæµ‹è¯•-åˆ†äº«åŠŸèƒ½.md
git add åˆ†äº«åŠŸèƒ½-åŒæ–‡ä»¶å¤¹æ›´æ–°æŒ‡å—.md

# æäº¤
git commit -m "ä¿®å¤åˆ†äº«åŠŸèƒ½ - æ·»åŠ åˆ†äº«é¡µé¢å’Œé™æ€æ–‡ä»¶è·¯ç”±"

# æ¨é€åˆ°GitHub
git push origin main
```

#### Step 2: æ ‘è“æ´¾ä¸Šéƒ¨ç½²

```bash
# SSHç™»å½•æ ‘è“æ´¾
ssh pi@raspberrypi.local

# è¿›å…¥æ›´æ–°æ–‡ä»¶å¤¹
cd ~/Desktop/Github/RaspiOwnCloud

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¿«é€Ÿéƒ¨ç½²åˆ°ç”Ÿäº§
bash scripts/quick_update.sh

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status raspberrycloud

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u raspberrycloud -f
```

---

### æ–¹æ¡ˆCï¼šæ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶ï¼ˆä¸æ¨èä½†å¯ç”¨ï¼‰

å¦‚æœæ— æ³•ä½¿ç”¨Gitï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºæ–‡ä»¶ï¼š

#### 1. åœ¨æ ‘è“æ´¾æ›´æ–°æ–‡ä»¶å¤¹åˆ›å»ºæ–‡ä»¶

```bash
# SSHç™»å½•æ ‘è“æ´¾
ssh pi@raspberrypi.local

# è¿›å…¥æ›´æ–°æ–‡ä»¶å¤¹
cd ~/Desktop/Github/RaspiOwnCloud

# åˆ›å»ºåˆ†äº«é¡µé¢
nano frontend/share.html
# ç²˜è´´ share.html çš„å†…å®¹ï¼ˆè§é™„å½•Aï¼‰

# åˆ›å»ºåˆ†äº«è„šæœ¬
nano frontend/js/share.js
# ç²˜è´´ share.js çš„å†…å®¹ï¼ˆè§é™„å½•Bï¼‰

# ä¿®æ”¹main.py
nano backend/main.py
# æŒ‰ç…§é™„å½•Cçš„è¯´æ˜ä¿®æ”¹
```

#### 2. éƒ¨ç½²åˆ°ç”Ÿäº§

```bash
# åœ¨æ›´æ–°æ–‡ä»¶å¤¹æ‰§è¡Œ
cd ~/Desktop/Github/RaspiOwnCloud
bash scripts/quick_update.sh
```

## âœ… éªŒè¯æ›´æ–°æ˜¯å¦æˆåŠŸ

### 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¤åˆ¶åˆ°ç”Ÿäº§æ–‡ä»¶å¤¹

```bash
# æ£€æŸ¥åˆ†äº«é¡µé¢
ls -lh /opt/raspberrycloud/frontend/share.html

# æ£€æŸ¥åˆ†äº«è„šæœ¬
ls -lh /opt/raspberrycloud/frontend/js/share.js

# æ£€æŸ¥main.pyä¿®æ”¹æ—¶é—´
ls -lh /opt/raspberrycloud/backend/main.py
```

åº”è¯¥çœ‹åˆ°æ–‡ä»¶å­˜åœ¨ä¸”ä¿®æ”¹æ—¶é—´æ˜¯æœ€æ–°çš„ã€‚

### 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status raspberrycloud

# åº”è¯¥çœ‹åˆ° "active (running)" çŠ¶æ€
```

### 3. æ£€æŸ¥æ—¥å¿—

```bash
# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
sudo journalctl -u raspberrycloud -n 50

# åº”è¯¥çœ‹åˆ°ï¼š
# âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
# âœ… å­˜å‚¨ç›®å½•æ£€æŸ¥å®Œæˆ
# âœ¨ RaspberryCloud å¯åŠ¨æˆåŠŸï¼
```

### 4. æµ‹è¯•åˆ†äº«åŠŸèƒ½

```bash
# æ–¹å¼1ï¼šä»æ ‘è“æ´¾æœ¬åœ°è®¿é—®
curl -I http://localhost:8000/share/test123

# åº”è¯¥è¿”å› 200 OKï¼ˆå³ä½¿åˆ†äº«ç ä¸å­˜åœ¨ï¼Œé¡µé¢ä¹Ÿèƒ½åŠ è½½ï¼‰

# æ–¹å¼2ï¼šä»å±€åŸŸç½‘è®¿é—®
# åœ¨æµè§ˆå™¨æ‰“å¼€ï¼šhttp://æ ‘è“æ´¾IP:8000
```

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### 1. ç™»å½•ç³»ç»Ÿ
```
æµè§ˆå™¨è®¿é—®ï¼šhttp://æ ‘è“æ´¾IP:8000
æˆ–ï¼šhttp://raspberrycloud.local
```

### 2. åˆ›å»ºåˆ†äº«
1. ç™»å½•è´¦å·
2. é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶
3. ç‚¹å‡»"åˆ†äº«"æŒ‰é’® ğŸ“¤
4. è®¾ç½®é€‰é¡¹ï¼š
   - æœ‰æ•ˆæœŸï¼š7å¤©
   - å‹¾é€‰"éœ€è¦æå–ç "
5. ç‚¹å‡»"åˆ›å»ºåˆ†äº«"
6. **è®°ä¸‹åˆ†äº«é“¾æ¥å’Œæå–ç **

### 3. æµ‹è¯•åˆ†äº«é“¾æ¥
1. æ‰“å¼€æ–°æ ‡ç­¾é¡µ
2. ç²˜è´´åˆ†äº«é“¾æ¥
3. âœ… åº”è¯¥çœ‹åˆ°æ¼‚äº®çš„åˆ†äº«é¡µé¢
4. è¾“å…¥æå–ç 
5. ç‚¹å‡»ä¸‹è½½
6. âœ… æ–‡ä»¶åº”è¯¥å¼€å§‹ä¸‹è½½

### 4. æµ‹è¯•æœªç™»å½•è®¿é—®
1. æ‰“å¼€æ— ç—•çª—å£
2. ç²˜è´´åˆ†äº«é“¾æ¥
3. âœ… æœªç™»å½•ä¹Ÿèƒ½è®¿é—®å’Œä¸‹è½½

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: åˆ†äº«é“¾æ¥æ˜¾ç¤º404

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh /opt/raspberrycloud/frontend/share.html
ls -lh /opt/raspberrycloud/frontend/js/share.js

# 2. æ£€æŸ¥main.pyæ˜¯å¦æ›´æ–°
grep -n "StaticFiles" /opt/raspberrycloud/backend/main.py

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# from fastapi.staticfiles import StaticFiles
# app.mount("/css", StaticFiles(...

# 3. æ£€æŸ¥æœåŠ¡æ˜¯å¦é‡å¯
sudo systemctl status raspberrycloud

# 4. é‡æ–°éƒ¨ç½²
cd ~/Desktop/Github/RaspiOwnCloud
bash scripts/quick_update.sh
```

### é—®é¢˜2: æœåŠ¡å¯åŠ¨å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š

```bash
# 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u raspberrycloud -n 100 --no-pager

# 2. æ£€æŸ¥Pythonè¯­æ³•é”™è¯¯
cd /opt/raspberrycloud/backend
sudo -u www-data bash -c 'source ../venv/bin/activate && python -m py_compile main.py'

# 3. æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
cd /opt/raspberrycloud/backend
sudo -u www-data bash -c 'source ../venv/bin/activate && python main.py'

# æŒ‰Ctrl+Cåœæ­¢ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯
```

### é—®é¢˜3: é™æ€æ–‡ä»¶è·¯å¾„é”™è¯¯

å¦‚æœå‡ºç°é™æ€æ–‡ä»¶404ï¼Œæ£€æŸ¥è·¯å¾„ï¼š

```bash
# æ£€æŸ¥æ–‡ä»¶ç»“æ„
ls -lh /opt/raspberrycloud/frontend/
ls -lh /opt/raspberrycloud/frontend/js/
ls -lh /opt/raspberrycloud/frontend/css/

# main.pyä¸­çš„è·¯å¾„åº”è¯¥æ˜¯ç›¸å¯¹è·¯å¾„
cd /opt/raspberrycloud/backend
pwd
# è¾“å‡ºåº”è¯¥æ˜¯ï¼š/opt/raspberrycloud/backend

# æ‰€ä»¥frontendåº”è¯¥åœ¨ ../frontend/
```

**ä¿®å¤æ–¹æ³•**ï¼š

ç¼–è¾‘ `/opt/raspberrycloud/backend/main.py`ï¼Œç¡®ä¿é™æ€æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼š

```python
# æ­£ç¡®çš„è·¯å¾„ï¼ˆç›¸å¯¹äºbackendç›®å½•ï¼‰
app.mount("/css", StaticFiles(directory="../frontend/css"), name="css")
app.mount("/js", StaticFiles(directory="../frontend/js"), name="js")
```

### é—®é¢˜4: æƒé™é”™è¯¯

```bash
# ä¿®å¤ç”Ÿäº§æ–‡ä»¶å¤¹æƒé™
sudo chown -R www-data:www-data /opt/raspberrycloud
sudo chmod -R 755 /opt/raspberrycloud

# é‡å¯æœåŠ¡
sudo systemctl restart raspberrycloud
```

## ğŸ“Š æ›´æ–°å‰åå¯¹æ¯”

### æ›´æ–°å‰ âŒ
```
åˆ›å»ºåˆ†äº« â†’ å¤åˆ¶é“¾æ¥ â†’ ç²˜è´´åˆ°æµè§ˆå™¨ â†’ 404é”™è¯¯
```

### æ›´æ–°å âœ…
```
åˆ›å»ºåˆ†äº« â†’ å¤åˆ¶é“¾æ¥ â†’ ç²˜è´´åˆ°æµè§ˆå™¨ â†’ çœ‹åˆ°åˆ†äº«é¡µé¢ â†’ è¾“å…¥æå–ç  â†’ ä¸‹è½½æ–‡ä»¶
```

## ğŸ¯ å…³é”®æ–‡ä»¶æ£€æŸ¥æ¸…å•

åœ¨ç”Ÿäº§æ–‡ä»¶å¤¹ä¸­ï¼Œç¡®è®¤ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š

```bash
# è¿è¡Œæ£€æŸ¥è„šæœ¬
cat << 'EOF' | bash
echo "æ£€æŸ¥åˆ†äº«åŠŸèƒ½æ–‡ä»¶..."
files=(
    "/opt/raspberrycloud/frontend/share.html"
    "/opt/raspberrycloud/frontend/js/share.js"
    "/opt/raspberrycloud/backend/main.py"
)
for file in "${files[@]}"; do
    if [ -f "$file" ]; then
        echo "âœ… $file ($(stat -c%y "$file" | cut -d' ' -f1))"
    else
        echo "âŒ $file - æ–‡ä»¶ä¸å­˜åœ¨ï¼"
    fi
done

echo ""
echo "æ£€æŸ¥main.pyä¸­çš„å…³é”®ä»£ç ..."
if grep -q "StaticFiles" /opt/raspberrycloud/backend/main.py; then
    echo "âœ… StaticFiles å¯¼å…¥å­˜åœ¨"
else
    echo "âŒ ç¼ºå°‘ StaticFiles å¯¼å…¥"
fi

if grep -q '/share/{share_code}' /opt/raspberrycloud/backend/main.py; then
    echo "âœ… åˆ†äº«è·¯ç”±å­˜åœ¨"
else
    echo "âŒ ç¼ºå°‘åˆ†äº«è·¯ç”±"
fi

echo ""
echo "æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
sudo systemctl is-active raspberrycloud
EOF
```

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# === æ›´æ–°ä»£ç  ===
cd ~/Desktop/Github/RaspiOwnCloud
git pull origin main

# === éƒ¨ç½²åˆ°ç”Ÿäº§ ===
bash scripts/quick_update.sh

# === æŸ¥çœ‹æœåŠ¡ ===
sudo systemctl status raspberrycloud
sudo journalctl -u raspberrycloud -f

# === é‡å¯æœåŠ¡ ===
sudo systemctl restart raspberrycloud

# === æ£€æŸ¥æ–‡ä»¶ ===
ls -lh /opt/raspberrycloud/frontend/share.html
ls -lh /opt/raspberrycloud/frontend/js/share.js

# === å¤‡ä»½ï¼ˆæ›´æ–°å‰ï¼‰ ===
sudo cp -r /opt/raspberrycloud /opt/raspberrycloud_backup_$(date +%Y%m%d_%H%M)

# === å›æ»šï¼ˆå¦‚æœå‡ºé—®é¢˜ï¼‰ ===
sudo systemctl stop raspberrycloud
sudo cp -r /opt/raspberrycloud_backup_YYYYMMDD_HHMM/* /opt/raspberrycloud/
sudo systemctl start raspberrycloud
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ›´æ–°å‰å¤‡ä»½**
   ```bash
   sudo cp -r /opt/raspberrycloud /opt/raspberrycloud_backup_$(date +%Y%m%d)
   ```

2. **é€æ­¥æµ‹è¯•**
   - å…ˆéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
   - ç¡®è®¤åŠŸèƒ½æ­£å¸¸åå†æ›´æ–°ç”Ÿäº§
   
3. **æŸ¥çœ‹æ—¥å¿—**
   - æ›´æ–°åç«‹å³æŸ¥çœ‹æ—¥å¿—
   - ç¡®è®¤æ²¡æœ‰é”™è¯¯ä¿¡æ¯

4. **ä¿ç•™å¤‡ä»½**
   - è‡³å°‘ä¿ç•™æœ€è¿‘3ä¸ªç‰ˆæœ¬çš„å¤‡ä»½
   - å®šæœŸæ¸…ç†æ—§å¤‡ä»½

## â“ å¸¸è§é—®é¢˜

**Q: quick_update.sh éœ€è¦sudoå—ï¼Ÿ**  
A: å–å†³äºè„šæœ¬å†…å®¹ã€‚å¦‚æœæç¤ºæƒé™é”™è¯¯ï¼Œå°±åŠ ä¸Šsudoã€‚

**Q: æ›´æ–°ä¼šè¦†ç›–.envé…ç½®å—ï¼Ÿ**  
A: ä¸ä¼šã€‚æ›´æ–°è„šæœ¬ä¼šä¿æŠ¤ `.env` å’Œæ•°æ®åº“æ–‡ä»¶ã€‚

**Q: éœ€è¦é‡å¯ç³»ç»Ÿå—ï¼Ÿ**  
A: ä¸éœ€è¦ï¼Œé‡å¯æœåŠ¡å³å¯ï¼š`sudo systemctl restart raspberrycloud`

**Q: å¦‚ä½•ç¡®è®¤æ›´æ–°æˆåŠŸï¼Ÿ**  
A: æ£€æŸ¥ä¸‰ç‚¹ï¼š1) æ–‡ä»¶å­˜åœ¨ 2) æœåŠ¡è¿è¡Œ 3) åˆ†äº«é“¾æ¥èƒ½æ‰“å¼€

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`sudo journalctl -u raspberrycloud -n 100`
2. æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š`ls -lh /opt/raspberrycloud/`
3. è¿è¡Œä¸Šé¢çš„"å…³é”®æ–‡ä»¶æ£€æŸ¥æ¸…å•"è„šæœ¬

---

## é™„å½•ï¼šæ‰‹åŠ¨æ›´æ–°æ‰€éœ€çš„å®Œæ•´ä»£ç 

### é™„å½•A: frontend/share.html

è¯·å‚è€ƒé¡¹ç›®ä¸­çš„ `frontend/share.html` æ–‡ä»¶ï¼Œæˆ–ä»GitHubè·å–ã€‚

### é™„å½•B: frontend/js/share.js

è¯·å‚è€ƒé¡¹ç›®ä¸­çš„ `frontend/js/share.js` æ–‡ä»¶ï¼Œæˆ–ä»GitHubè·å–ã€‚

### é™„å½•C: backend/main.py ä¿®æ”¹è¯´æ˜

éœ€è¦åœ¨ `backend/main.py` ä¸­æ·»åŠ ï¼š

1. **åœ¨å¯¼å…¥éƒ¨åˆ†æ·»åŠ **ï¼š
```python
from fastapi import FastAPI, Depends, HTTPException, status, File as FastAPIFile, UploadFile, Form, Request
from fastapi.staticfiles import StaticFiles
```

2. **åœ¨å¯åŠ¨äº‹ä»¶ä¹‹å‰æ·»åŠ **ï¼š
```python
# ==================== é™æ€æ–‡ä»¶å’Œå‰ç«¯è·¯ç”± ====================

# æŒ‚è½½é™æ€æ–‡ä»¶ï¼ˆCSSã€JSç­‰ï¼‰
app.mount("/css", StaticFiles(directory="../frontend/css"), name="css")
app.mount("/js", StaticFiles(directory="../frontend/js"), name="js")


@app.get("/share/{share_code}")
async def share_page(share_code: str):
    """åˆ†äº«é¡µé¢è·¯ç”±"""
    share_html = Path("../frontend/share.html")
    if share_html.exists():
        return FileResponse(share_html)
    raise HTTPException(status_code=404, detail="é¡µé¢ä¸å­˜åœ¨")


@app.get("/")
async def root():
    """æ ¹è·¯å¾„é‡å®šå‘åˆ°å‰ç«¯é¦–é¡µ"""
    index_html = Path("../frontend/index.html")
    if index_html.exists():
        return FileResponse(index_html)
    raise HTTPException(status_code=404, detail="é¡µé¢ä¸å­˜åœ¨")
```

3. **ä¿®æ”¹ create_share å‡½æ•°**ï¼š
```python
@app.post("/api/shares/create", response_model=ShareResponse)
async def create_share(
    request: Request,  # æ·»åŠ è¿™ä¸ªå‚æ•°
    share_data: ShareCreate,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    # ... å…¶ä»–ä»£ç ä¸å˜ ...
    
    # ä¿®æ”¹è¿™éƒ¨åˆ†ï¼š
    # åŠ¨æ€æ„å»ºåˆ†äº«URLï¼ˆä»è¯·æ±‚å¤´è·å–ï¼‰
    host = request.headers.get("host", "localhost:8000")
    scheme = request.url.scheme
    base_url = f"{scheme}://{host}"
    share_url = f"{base_url}/share/{share.share_code}"
    
    # ... å…¶ä»–ä»£ç ä¸å˜ ...
```

å®Œæ•´çš„ä¿®æ”¹è¯·æŸ¥çœ‹é¡¹ç›®ä¸­çš„æ–‡ä»¶ã€‚




