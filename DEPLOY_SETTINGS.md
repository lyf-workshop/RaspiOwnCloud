# 个人中心功能部署指南

## 📦 本次更新内容

### 新增文件
- `frontend/js/user-settings.js` - 个人中心和设置模块

### 修改文件
- `frontend/index.html` - 引入新JS文件
- `frontend/css/style.css` - 添加设置页面样式
- `backend/main.py` - 修改密码API支持JSON格式

---

## 🚀 部署步骤

### 步骤1：Windows端提交
```powershell
cd F:\Github\RaspiOwnCloud

# 添加所有修改
git add frontend/js/user-settings.js
git add frontend/css/style.css
git add frontend/index.html
git add backend/main.py
git add 个人中心使用指南.md
git add DEPLOY_SETTINGS.md

# 提交
git commit -m "新增个人中心和设置功能"

# 推送
git push origin main
```

### 步骤2：树莓派部署
```bash
# SSH登录
ssh pi@raspberrypi.local

# 进入项目目录
cd ~/Desktop/Github/RaspiOwnCloud

# 拉取最新代码
git pull origin main

# 复制前端文件
sudo cp -r frontend/* /var/www/raspberrycloud/

# 设置权限
sudo chown -R www-data:www-data /var/www/raspberrycloud
sudo chmod -R 755 /var/www/raspberrycloud

# 重启后端服务
sudo systemctl restart raspberrycloud

# 检查状态
sudo systemctl status raspberrycloud
```

### 步骤3：清除浏览器缓存
- **Windows**: `Ctrl + F5`
- **Mac**: `Cmd + Shift + R`
- **或使用隐身模式测试**

---

## ✅ 功能测试清单

### 1. 基本功能
- [ ] 右上角用户菜单正常显示
- [ ] 点击"设置"打开个人中心对话框
- [ ] 左侧导航栏正常显示5个选项

### 2. 个人信息
- [ ] 用户名正确显示
- [ ] 注册时间正确显示
- [ ] 头像图标正常显示

### 3. 存储管理
- [ ] 环形图表正常绘制
- [ ] 存储数据正确显示
- [ ] 文件类型列表正常加载

### 4. 安全设置
- [ ] 密码输入框正常显示
- [ ] 修改密码功能正常工作
- [ ] 当前设备信息显示

### 5. 外观设置
- [ ] 主题选项正常显示
- [ ] 默认视图切换功能正常
- [ ] 设置保存并应用

### 6. 关于页面
- [ ] 系统信息正确显示
- [ ] 功能列表完整显示
- [ ] Logo和版本号正确

### 7. 响应式
- [ ] 移动端布局正常
- [ ] 平板端布局正常
- [ ] 桌面端布局正常

---

## 🎯 重点测试：修改密码

### 测试步骤
```
1. 打开个人中心 → 安全设置
2. 输入当前密码（你的实际密码）
3. 输入新密码：test123456
4. 确认新密码：test123456
5. 点击"修改密码"
6. 应显示"密码修改成功"
7. 2秒后自动退出到登录页面
8. 使用新密码登录
9. 再次修改回原密码
```

### 预期结果
- ✅ 修改成功提示
- ✅ 自动退出登录
- ✅ 新密码可以登录
- ✅ 旧密码无法登录

---

## 🐛 问题排查

### 问题1：设置对话框不显示
**检查**：
```bash
# 检查JS文件
ls -lh /var/www/raspberrycloud/js/user-settings.js

# 查看浏览器控制台
# 是否有JS错误
```

### 问题2：存储图表不显示
**原因**：Canvas API问题
**解决**：刷新页面，检查浏览器兼容性

### 问题3：修改密码失败
**检查后端日志**：
```bash
sudo journalctl -u raspberrycloud -n 100
```

**常见错误**：
- "当前密码不正确" - 检查输入
- "缺少必要参数" - 检查API调用

### 问题4：样式混乱
**解决**：
```bash
# 清除浏览器缓存
Ctrl + F5

# 检查CSS文件
cat /var/www/raspberrycloud/css/style.css | grep "settings-container"
```

---

## 📱 移动端测试

### Chrome DevTools模拟
```
1. 打开Chrome开发者工具（F12）
2. 点击设备模拟按钮
3. 选择设备：
   - iPhone 12 Pro
   - iPad Air
   - Pixel 5
4. 测试个人中心各功能
```

### 检查要点
- [ ] 侧边导航改为顶部标签
- [ ] 标签可以横向滚动
- [ ] 内容区域垂直滚动
- [ ] 按钮大小适合触摸
- [ ] 图表在小屏幕正常显示

---

## 🎨 界面预览

### 桌面端
```
┌────────────────────────────────────┐
│  ⚙️ 个人中心与设置          [×]   │
├──────┬─────────────────────────────┤
│ 👤个人│ 个人信息                    │
│      │ ┌──────────────┐            │
│ 💾存储│ │  👤          │            │
│      │ │  [更换头像]  │            │
│ 🔒安全│ └──────────────┘            │
│      │ 用户名：admin               │
│ 🎨外观│ 邮箱：[编辑]                │
│      │ 注册时间：2024-01-01        │
│ ℹ️关于│ [保存更改]                  │
│      │                             │
└──────┴─────────────────────────────┘
```

### 移动端
```
┌────────────────────────┐
│ ⚙️ 个人中心与设置  [×] │
├────────────────────────┤
│ [👤] [💾] [🔒] [🎨] [ℹ️] │ ← 横向滚动
├────────────────────────┤
│                        │
│   个人信息内容          │
│   ↓                    │
│   垂直滚动             │
│   ↓                    │
│                        │
└────────────────────────┘
```

---

## 📊 功能统计

### 新增内容
- 📄 **1个新JS文件**（user-settings.js，600+行）
- 🎨 **新增CSS样式**（400+行）
- 🔧 **1个API改进**（change-password支持JSON）
- 📱 **5个功能模块**
- 📖 **2份文档**

### 代码统计
```
frontend/js/user-settings.js    ~650行
frontend/css/style.css (新增)   ~450行
backend/main.py (修改)          ~30行
--------------------------------
总计                            ~1130行
```

---

## 🎯 用户价值

### 更新前
```
❌ 无法查看账号信息
❌ 不知道存储使用情况
❌ 无法修改密码
❌ 没有个人设置中心
```

### 更新后
```
✅ 完整的个人中心
✅ 可视化存储统计
✅ 安全的密码修改
✅ 丰富的系统设置
✅ 专业的界面设计
```

---

## 🔮 后续计划

### 即将推出（优先级高）
1. 头像上传功能
2. 邮箱修改功能
3. 深色主题
4. 回收站管理

### 中期计划
1. 多设备登录管理
2. 登录历史记录
3. 两步验证
4. 存储清理工具

---

## 📝 更新日志

### 版本 1.1.0 (2024-12-21)

**新增功能**：
- ✨ 个人中心界面
- ✨ 5个功能模块（个人信息、存储管理、安全设置、外观设置、关于）
- ✨ 修改密码功能
- ✨ 存储可视化统计
- ✨ 文件类型分析
- ✨ 默认视图设置
- ✨ 移动端适配

**改进**：
- 🔧 修改密码API支持JSON格式
- 🎨 统一的设计语言
- 📱 完整的响应式支持

---

## ✅ 部署完成确认

完成以下所有步骤后，功能部署成功：

- [ ] 代码已推送到Git仓库
- [ ] 树莓派已拉取最新代码
- [ ] 前端文件已复制到生产目录
- [ ] 后端服务已重启
- [ ] 服务状态正常
- [ ] 浏览器缓存已清除
- [ ] 个人中心可以打开
- [ ] 所有标签页正常切换
- [ ] 修改密码功能测试通过
- [ ] 存储统计正确显示
- [ ] 移动端布局正常

---

## 🎊 部署成功！

恭喜！你的云盘现在拥有了完整的个人中心功能！

现在用户可以：
- 📊 随时查看存储使用情况
- 🔐 自主修改登录密码
- ⚙️ 自定义界面设置
- 📱 在任何设备上使用

**享受全新的个人中心体验！** 🚀

