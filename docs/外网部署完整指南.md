# å¤–ç½‘éƒ¨ç½²å®Œæ•´æŒ‡å—

å®ç°ä»ä»»ä½•åœ°æ–¹è®¿é—®ä½ çš„ RaspberryCloud ç§æœ‰äº‘å­˜å‚¨ç³»ç»Ÿã€‚

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æ£€æŸ¥å…¬ç½‘IP

```bash
# åœ¨æ ‘è“æ´¾ä¸Šæ£€æŸ¥
curl ip.sb

# æˆ–
curl ifconfig.me

# è®°å½•è¿™ä¸ªIPåœ°å€
```

**é‡è¦è¯´æ˜ï¼š**
- å¦‚æœIPæ˜¯ `10.x.x.x`ã€`172.16-31.x.x` æˆ– `192.168.x.x`ï¼Œè¯´æ˜æ˜¯å†…ç½‘IPï¼Œéœ€è¦è”ç³»è¿è¥å•†ç”³è¯·å…¬ç½‘IP
- å¦‚æœIPæ˜¯å…¬ç½‘IPï¼Œä½†æ¯æ¬¡é‡å¯ä¼šå˜åŒ–ï¼Œéœ€è¦é…ç½®DDNS

### 2. è·å–åŸŸåï¼ˆå¯é€‰ä½†æ¨èï¼‰

**å…è´¹åŸŸåé€‰é¡¹ï¼š**
- **Freenom** (å…è´¹ .tk/.ml/.ga åŸŸå)
- **No-IP** (å…è´¹åŠ¨æ€åŸŸå)
- **DuckDNS** (å…è´¹åŠ¨æ€åŸŸå)
- **Cloudflare** (å…è´¹åŸŸåè§£æ)

**ä»˜è´¹åŸŸåï¼š**
- é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€GoDaddyç­‰

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šé…ç½®è·¯ç”±å™¨ç«¯å£è½¬å‘

#### 1.1 ç™»å½•è·¯ç”±å™¨

```
1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—®è·¯ç”±å™¨ç®¡ç†åœ°å€ï¼ˆé€šå¸¸æ˜¯ 192.168.1.1 æˆ– 192.168.0.1ï¼‰
3. è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç 
```

#### 1.2 é…ç½®ç«¯å£è½¬å‘è§„åˆ™

**æ‰¾åˆ°ç«¯å£è½¬å‘/è™šæ‹ŸæœåŠ¡å™¨è®¾ç½®ï¼š**
- TP-Link: åº”ç”¨ç®¡ç† â†’ è™šæ‹ŸæœåŠ¡å™¨
- åä¸º: å®‰å…¨è®¾ç½® â†’ è™šæ‹ŸæœåŠ¡å™¨  
- å°ç±³: é«˜çº§è®¾ç½® â†’ ç«¯å£è½¬å‘
- åç¡•: é«˜çº§è®¾ç½® â†’ ç«¯å£è½¬å‘

**æ·»åŠ è§„åˆ™ï¼š**

| è§„åˆ™åç§° | å¤–éƒ¨ç«¯å£ | å†…éƒ¨IP | å†…éƒ¨ç«¯å£ | åè®® |
|---------|---------|--------|---------|------|
| HTTP | 8080 | æ ‘è“æ´¾IP | 80 | TCP |
| HTTPS | 8443 | æ ‘è“æ´¾IP | 443 | TCP |
| SSH | 2222 | æ ‘è“æ´¾IP | 22 | TCP |

**ç¤ºä¾‹ï¼š**
- æ ‘è“æ´¾IP: `192.168.1.100`
- å¤–éƒ¨ç«¯å£: `8080` â†’ å†…éƒ¨ç«¯å£: `80`
- å¤–éƒ¨ç«¯å£: `8443` â†’ å†…éƒ¨ç«¯å£: `443`

**æ³¨æ„ï¼š**
- å¦‚æœè¿è¥å•†å°ç¦80/443ç«¯å£ï¼Œä½¿ç”¨å…¶ä»–ç«¯å£ï¼ˆå¦‚8080/8443ï¼‰
- ä¿å­˜é…ç½®åï¼Œè·¯ç”±å™¨å¯èƒ½éœ€è¦é‡å¯

### æ­¥éª¤2ï¼šé…ç½®åŠ¨æ€DNSï¼ˆDDNSï¼‰

å¦‚æœæ²¡æœ‰å›ºå®šå…¬ç½‘IPï¼Œéœ€è¦é…ç½®DDNSã€‚

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è·¯ç”±å™¨å†…ç½®DDNSï¼ˆæ¨èï¼‰

```
1. è·¯ç”±å™¨ç®¡ç†é¡µé¢ â†’ åŠ¨æ€DNS/DDNS
2. é€‰æ‹©æœåŠ¡å•†ï¼ˆå¦‚èŠ±ç”Ÿå£³ã€No-IPï¼‰
3. æ³¨å†Œè´¦å·å¹¶è·å–åŸŸå
4. åœ¨è·¯ç”±å™¨ä¸­è¾“å…¥è´¦å·å¯†ç 
5. ä¿å­˜å¹¶å¯ç”¨
```

#### æ–¹æ³•äºŒï¼šåœ¨æ ‘è“æ´¾ä¸Šé…ç½®DDNS

**ä½¿ç”¨ DuckDNSï¼ˆå…è´¹ï¼Œæ¨èï¼‰ï¼š**

```bash
# 1. è®¿é—® https://www.duckdns.org æ³¨å†Œè´¦å·
# 2. åˆ›å»ºä¸€ä¸ªå­åŸŸåï¼Œå¦‚: mycloud.duckdns.org
# 3. è·å–Token

# 4. åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…æ›´æ–°è„šæœ¬
sudo nano /opt/raspberrycloud/scripts/update_ddns.sh
```

åˆ›å»ºè„šæœ¬å†…å®¹ï¼š

```bash
#!/bin/bash
DOMAIN="ä½ çš„åŸŸå.duckdns.org"
TOKEN="ä½ çš„Token"

curl "https://www.duckdns.org/update?domains=$DOMAIN&token=$TOKEN&ip="
```

```bash
# 5. è®¾ç½®å¯æ‰§è¡Œ
chmod +x /opt/raspberrycloud/scripts/update_ddns.sh

# 6. æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ï¼ˆæ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼‰
sudo crontab -e
# æ·»åŠ ï¼š
*/5 * * * * /opt/raspberrycloud/scripts/update_ddns.sh
```

### æ­¥éª¤3ï¼šé…ç½®HTTPSï¼ˆLet's Encryptï¼‰

#### 3.1 å®‰è£…Certbot

```bash
sudo apt update
sudo apt install -y certbot python3-certbot-nginx
```

#### 3.2 ä¿®æ”¹Nginxé…ç½®

```bash
sudo nano /etc/nginx/sites-available/raspberrycloud
```

ä¿®æ”¹ `server_name` ä¸ºä½ çš„åŸŸåï¼š

```nginx
server_name your-domain.com www.your-domain.com;
```

```bash
sudo nginx -t
sudo systemctl reload nginx
```

#### 3.3 ç”³è¯·SSLè¯ä¹¦

```bash
# ä½¿ç”¨nginxæ’ä»¶è‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# æŒ‰æç¤ºæ“ä½œï¼š
# 1. è¾“å…¥é‚®ç®±åœ°å€
# 2. åŒæ„æœåŠ¡æ¡æ¬¾ (A)
# 3. æ˜¯å¦æ¥æ”¶é‚®ä»¶ (N)
# 4. æ˜¯å¦é‡å®šå‘HTTPåˆ°HTTPS (2 - æ¨è)
```

#### 3.4 éªŒè¯è¯ä¹¦

```bash
# æµ‹è¯•è¯ä¹¦ç»­æœŸ
sudo certbot renew --dry-run

# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
sudo certbot certificates
```

#### 3.5 è®¾ç½®è‡ªåŠ¨ç»­æœŸ

```bash
sudo crontab -e
# æ·»åŠ ï¼ˆæ¯æœˆ1æ—¥å‡Œæ™¨3ç‚¹æ£€æŸ¥ç»­æœŸï¼‰
0 3 1 * * certbot renew --quiet && systemctl reload nginx
```

### æ­¥éª¤4ï¼šæ›´æ–°é˜²ç«å¢™è§„åˆ™

```bash
# å…è®¸å¤–éƒ¨ç«¯å£ï¼ˆå¦‚æœä½¿ç”¨éæ ‡å‡†ç«¯å£ï¼‰
sudo ufw allow 8080/tcp
sudo ufw allow 8443/tcp

# å¦‚æœä½¿ç”¨æ ‡å‡†ç«¯å£
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

### æ­¥éª¤5ï¼šéªŒè¯å¤–ç½‘è®¿é—®

#### 5.1 ä½¿ç”¨æ‰‹æœº4G/5Gç½‘ç»œæµ‹è¯•

```
1. å…³é—­æ‰‹æœºWiFiï¼Œä½¿ç”¨ç§»åŠ¨æ•°æ®
2. æµè§ˆå™¨è®¿é—®: https://your-domain.com
3. æˆ–è®¿é—®: http://ä½ çš„å…¬ç½‘IP:8080
```

#### 5.2 ä½¿ç”¨åœ¨çº¿å·¥å…·æµ‹è¯•

è®¿é—® https://www.yougetsignal.com/tools/open-ports/
- è¾“å…¥ä½ çš„å…¬ç½‘IP
- è¾“å…¥ç«¯å£ 8080 æˆ– 8443
- ç‚¹å‡»æ£€æŸ¥

## ğŸ”’ å®‰å…¨åŠ å›ºï¼ˆé‡è¦ï¼ï¼‰

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 

```bash
# ç™»å½•Webç•Œé¢ï¼Œç«‹å³ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
# é»˜è®¤: admin / RaspberryCloud2024!
```

### 2. é…ç½®Fail2banï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰

```bash
# å®‰è£…
sudo apt install -y fail2ban

# åˆ›å»ºé…ç½®
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo nano /etc/fail2ban/jail.local
```

æ·»åŠ é…ç½®ï¼š

```ini
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3
ignoreip = 127.0.0.1/8 192.168.0.0/16

[sshd]
enabled = true
port = 22
maxretry = 3

[nginx-http-auth]
enabled = true
port = http,https
logpath = /var/log/nginx/raspberrycloud_error.log
maxretry = 5
```

```bash
# å¯åŠ¨Fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# æŸ¥çœ‹çŠ¶æ€
sudo fail2ban-client status
```

### 3. é™åˆ¶SSHè®¿é—®

```bash
# ä¿®æ”¹SSHç«¯å£ï¼ˆå¯é€‰ï¼‰
sudo nano /etc/ssh/sshd_config
# ä¿®æ”¹: Port 2222

# æ›´æ–°é˜²ç«å¢™
sudo ufw allow 2222/tcp
sudo ufw delete allow 22/tcp

# é‡å¯SSH
sudo systemctl restart ssh
```

### 4. å®šæœŸæ›´æ–°ç³»ç»Ÿ

```bash
# è®¾ç½®è‡ªåŠ¨æ›´æ–°
sudo apt install -y unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

## ğŸ“± ç§»åŠ¨ç«¯è®¿é—®

### iOS (iPhone/iPad)

```
1. Safariæµè§ˆå™¨è®¿é—® https://your-domain.com
2. ç‚¹å‡»åº•éƒ¨"åˆ†äº«"æŒ‰é’®
3. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"
4. è‡ªå®šä¹‰åç§°
5. å®Œæˆ
```

### Android

```
1. Chromeæµè§ˆå™¨è®¿é—® https://your-domain.com
2. ç‚¹å‡»å³ä¸Šè§’èœå•ï¼ˆä¸‰ä¸ªç‚¹ï¼‰
3. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"
4. å®Œæˆ
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ— æ³•ä»å¤–ç½‘è®¿é—®

**æ£€æŸ¥æ¸…å•ï¼š**
1. âœ… è·¯ç”±å™¨ç«¯å£è½¬å‘æ˜¯å¦é…ç½®æ­£ç¡®
2. âœ… é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£
3. âœ… æ ‘è“æ´¾æœåŠ¡æ˜¯å¦è¿è¡Œ
4. âœ… å…¬ç½‘IPæ˜¯å¦æ­£ç¡®
5. âœ… è¿è¥å•†æ˜¯å¦å°ç¦ç«¯å£

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
# åœ¨æ ‘è“æ´¾ä¸Šæµ‹è¯•
curl http://localhost:8000/api/health

# ä»å¤–ç½‘æµ‹è¯•ï¼ˆä½¿ç”¨æ‰‹æœº4Gï¼‰
curl http://ä½ çš„å…¬ç½‘IP:8080/api/health
```

### Q2: HTTPSè¯ä¹¦ç”³è¯·å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- åŸŸåæœªæ­£ç¡®è§£æåˆ°å…¬ç½‘IP
- 80ç«¯å£æœªå¼€æ”¾æˆ–æœªæ˜ å°„
- é˜²ç«å¢™é˜»æ­¢

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥åŸŸåè§£æ
nslookup your-domain.com

# æ£€æŸ¥80ç«¯å£
sudo lsof -i :80

# æ‰‹åŠ¨ç”³è¯·è¯ä¹¦
sudo certbot certonly --standalone -d your-domain.com
```

### Q3: è®¿é—®é€Ÿåº¦æ…¢

**ä¼˜åŒ–å»ºè®®ï¼š**
1. ä½¿ç”¨CDNåŠ é€Ÿï¼ˆCloudflareå…è´¹ç‰ˆï¼‰
2. ä¼˜åŒ–å›¾ç‰‡å¤§å°
3. å¯ç”¨Gzipå‹ç¼©
4. ä½¿ç”¨æ›´å¿«çš„ç½‘ç»œï¼ˆå‡çº§å¸¦å®½ï¼‰

## ğŸ“Š éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] è·¯ç”±å™¨ç«¯å£è½¬å‘å·²é…ç½®
- [ ] DDNSå·²é…ç½®ï¼ˆå¦‚æœæ²¡æœ‰å›ºå®šIPï¼‰
- [ ] HTTPSè¯ä¹¦å·²ç”³è¯·
- [ ] é˜²ç«å¢™è§„åˆ™å·²æ›´æ–°
- [ ] é»˜è®¤å¯†ç å·²ä¿®æ”¹
- [ ] Fail2banå·²å®‰è£…é…ç½®
- [ ] å¤–ç½‘è®¿é—®æµ‹è¯•æˆåŠŸ
- [ ] ç§»åŠ¨ç«¯è®¿é—®æµ‹è¯•æˆåŠŸ

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å¯ä»¥ä»ä»»ä½•åœ°æ–¹è®¿é—®ä½ çš„ç§æœ‰äº‘å­˜å‚¨äº†ï¼

**è®¿é—®åœ°å€ï¼š**
- HTTPS: `https://your-domain.com`
- HTTP: `http://your-domain.com:8080`ï¼ˆå¦‚æœä½¿ç”¨éæ ‡å‡†ç«¯å£ï¼‰

**å®‰å…¨æç¤ºï¼š**
- å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶
- ä½¿ç”¨å¼ºå¯†ç 
- å®šæœŸæ£€æŸ¥æ—¥å¿—
- å¤‡ä»½é‡è¦æ•°æ®






