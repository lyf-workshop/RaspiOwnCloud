# ç”µè„‘ç½‘ç»œè¿æ¥é…ç½®æŒ‡å—

å½“æ ‘è“æ´¾é€šè¿‡ç”µè„‘ç½‘ç»œè¿æ¥æ—¶çš„å¤–ç½‘è®¿é—®é…ç½®æ–¹æ¡ˆã€‚

## ğŸ” ç½‘ç»œæ‹“æ‰‘åˆ†æ

### å½“å‰æƒ…å†µ
```
äº’è”ç½‘
  â†“
è·¯ç”±å™¨ (å…¬ç½‘IP)
  â†“
ç”µè„‘ (192.168.x.x)
  â†“
æ ‘è“æ´¾ (é€šè¿‡ç”µè„‘ç½‘ç»œè¿æ¥)
```

### é—®é¢˜
- æ ‘è“æ´¾æ²¡æœ‰ç›´æ¥è¿æ¥åˆ°è·¯ç”±å™¨
- æ— æ³•åœ¨è·¯ç”±å™¨ä¸Šç›´æ¥é…ç½®ç«¯å£è½¬å‘åˆ°æ ‘è“æ´¾
- éœ€è¦é€šè¿‡ç”µè„‘è¿›è¡Œè½¬å‘

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šå°†æ ‘è“æ´¾ç›´æ¥è¿æ¥åˆ°è·¯ç”±å™¨ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•å¯é çš„æ–¹æ¡ˆã€‚

#### æ­¥éª¤1ï¼šè¿æ¥æ–¹å¼

**æœ‰çº¿è¿æ¥ï¼š**
```
1. ç”¨ç½‘çº¿è¿æ¥æ ‘è“æ´¾å’Œè·¯ç”±å™¨
2. æ ‘è“æ´¾ä¼šè‡ªåŠ¨è·å–IPåœ°å€
3. åœ¨è·¯ç”±å™¨ç®¡ç†é¡µé¢æŸ¥çœ‹æ ‘è“æ´¾çš„IP
```

**æ— çº¿è¿æ¥ï¼š**
```bash
# åœ¨æ ‘è“æ´¾ä¸Šé…ç½®WiFi
sudo raspi-config
# é€‰æ‹©: System Options â†’ Wireless LAN
# è¾“å…¥WiFiåç§°å’Œå¯†ç 
```

#### æ­¥éª¤2ï¼šè·å–æ ‘è“æ´¾IP

```bash
# åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œ
hostname -I

# æˆ–æŸ¥çœ‹è·¯ç”±å™¨ç®¡ç†é¡µé¢
# æ‰¾åˆ°è®¾å¤‡åä¸º "raspberrypi" çš„è®¾å¤‡
```

#### æ­¥éª¤3ï¼šé…ç½®è·¯ç”±å™¨ç«¯å£è½¬å‘

ç°åœ¨å¯ä»¥æ­£å¸¸é…ç½®è·¯ç”±å™¨ç«¯å£è½¬å‘äº†ã€‚

---

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ç”µè„‘ä½œä¸ºè½¬å‘ï¼ˆå¤æ‚ï¼Œä¸æ¨èï¼‰

å¦‚æœå¿…é¡»é€šè¿‡ç”µè„‘ç½‘ç»œè¿æ¥ï¼Œéœ€è¦é…ç½®ç”µè„‘çš„ç«¯å£è½¬å‘ã€‚

#### Windowsç³»ç»Ÿ

**ä½¿ç”¨netshé…ç½®ç«¯å£è½¬å‘ï¼š**

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell

# 1. å¯ç”¨IPè½¬å‘
netsh interface portproxy add v4tov4 listenport=8080 listenaddress=0.0.0.0 connectport=80 connectaddress=æ ‘è“æ´¾IP

# 2. æ·»åŠ é˜²ç«å¢™è§„åˆ™
New-NetFirewallRule -DisplayName "RaspberryCloud HTTP" -Direction Inbound -LocalPort 8080 -Protocol TCP -Action Allow

# 3. æŸ¥çœ‹è§„åˆ™
netsh interface portproxy show all

# 4. åˆ é™¤è§„åˆ™ï¼ˆå¦‚æœéœ€è¦ï¼‰
netsh interface portproxy delete v4tov4 listenport=8080 listenaddress=0.0.0.0
```

**é…ç½®è·¯ç”±å™¨ï¼š**
- å¤–éƒ¨ç«¯å£ï¼š8080 â†’ å†…éƒ¨IPï¼šç”µè„‘IP â†’ å†…éƒ¨ç«¯å£ï¼š8080

#### Linux/Macç³»ç»Ÿ

**ä½¿ç”¨iptablesé…ç½®ç«¯å£è½¬å‘ï¼š**

```bash
# 1. å¯ç”¨IPè½¬å‘
sudo sysctl -w net.ipv4.ip_forward=1

# 2. é…ç½®iptablesè§„åˆ™
sudo iptables -t nat -A PREROUTING -p tcp --dport 8080 -j DNAT --to-destination æ ‘è“æ´¾IP:80
sudo iptables -t nat -A POSTROUTING -j MASQUERADE

# 3. ä¿å­˜è§„åˆ™ï¼ˆUbuntu/Debianï¼‰
sudo apt install iptables-persistent
sudo netfilter-persistent save
```

---

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨å†…ç½‘ç©¿é€ï¼ˆæœ€ç®€å•ï¼Œæ¨èï¼‰

å¦‚æœæ— æ³•æ”¹å˜ç½‘ç»œç»“æ„ï¼Œä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ã€‚

#### é€‰é¡¹1ï¼šä½¿ç”¨frpï¼ˆå…è´¹ï¼Œè‡ªå»ºæœåŠ¡å™¨ï¼‰

**éœ€è¦ï¼š**
- ä¸€å°æœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨ï¼ˆæˆ–ä½¿ç”¨äº‘æœåŠ¡å™¨ï¼‰

**é…ç½®æ­¥éª¤ï¼š**

1. **åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…frpæœåŠ¡ç«¯**
```bash
# ä¸‹è½½frp
wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_arm64.tar.gz
tar -xzf frp_0.52.3_linux_arm64.tar.gz
cd frp_0.52.3_linux_arm64

# é…ç½®æœåŠ¡ç«¯
nano frps.ini
```

æœåŠ¡ç«¯é…ç½®ï¼š
```ini
[common]
bind_port = 7000
vhost_http_port = 8080
vhost_https_port = 8443
```

2. **åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…frpå®¢æˆ·ç«¯**
```bash
# ä¸‹è½½frp
wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_arm64.tar.gz
tar -xzf frp_0.52.3_linux_arm64.tar.gz
cd frp_0.52.3_linux_arm64

# é…ç½®å®¢æˆ·ç«¯
nano frpc.ini
```

å®¢æˆ·ç«¯é…ç½®ï¼š
```ini
[common]
server_addr = ä½ çš„æœåŠ¡å™¨IP
server_port = 7000

[web]
type = http
local_port = 80
custom_domains = ä½ çš„åŸŸå.com
```

#### é€‰é¡¹2ï¼šä½¿ç”¨ngrokï¼ˆå…è´¹ï¼Œæ— éœ€æœåŠ¡å™¨ï¼‰

**æ³¨å†Œè´¦å·ï¼š**
1. è®¿é—® https://ngrok.com
2. æ³¨å†Œå…è´¹è´¦å·
3. è·å–authtoken

**åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…ï¼š**
```bash
# ä¸‹è½½ngrok
wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-arm64.tgz
tar -xzf ngrok-v3-stable-linux-arm64.tgz
sudo mv ngrok /usr/local/bin/

# é…ç½®authtoken
ngrok config add-authtoken ä½ çš„token

# å¯åŠ¨éš§é“
ngrok http 80
```

**è®¿é—®ï¼š**
- ngrokä¼šæä¾›ä¸€ä¸ªä¸´æ—¶åŸŸåï¼Œå¦‚ï¼š`https://abc123.ngrok.io`
- å…è´¹ç‰ˆåŸŸåæ¯æ¬¡å¯åŠ¨ä¼šå˜åŒ–

#### é€‰é¡¹3ï¼šä½¿ç”¨Cloudflare Tunnelï¼ˆå…è´¹ï¼Œæ¨èï¼‰

**ä¼˜åŠ¿ï¼š**
- å®Œå…¨å…è´¹
- å¯ä»¥ä½¿ç”¨è‡ªå·±çš„åŸŸå
- ä¸éœ€è¦å…¬ç½‘IP

**é…ç½®æ­¥éª¤ï¼š**

1. **æ³¨å†ŒCloudflareè´¦å·**
   - è®¿é—® https://www.cloudflare.com
   - æ³¨å†Œè´¦å·å¹¶æ·»åŠ ä½ çš„åŸŸå

2. **åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…cloudflared**
```bash
# ä¸‹è½½å®‰è£…
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-arm64
sudo mv cloudflared-linux-arm64 /usr/local/bin/cloudflared
sudo chmod +x /usr/local/bin/cloudflared

# ç™»å½•
cloudflared tunnel login

# åˆ›å»ºéš§é“
cloudflared tunnel create raspberrycloud

# é…ç½®è·¯ç”±
cloudflared tunnel route dns raspberrycloud ä½ çš„åŸŸå.com

# è¿è¡Œéš§é“
cloudflared tunnel run raspberrycloud
```

---

### æ–¹æ¡ˆå››ï¼šä½¿ç”¨ZeroTierï¼ˆè™šæ‹Ÿå±€åŸŸç½‘ï¼‰

åˆ›å»ºè™šæ‹Ÿå±€åŸŸç½‘ï¼Œè®©æ ‘è“æ´¾è·å¾—è™šæ‹ŸIPã€‚

**é…ç½®æ­¥éª¤ï¼š**

1. **æ³¨å†ŒZeroTier**
   - è®¿é—® https://www.zerotier.com
   - æ³¨å†Œå…è´¹è´¦å·

2. **åˆ›å»ºç½‘ç»œ**
   - ç™»å½•ååˆ›å»ºç½‘ç»œ
   - è®°å½•Network ID

3. **åœ¨æ ‘è“æ´¾ä¸Šå®‰è£…**
```bash
# å®‰è£…
curl -s https://install.zerotier.com | sudo bash

# åŠ å…¥ç½‘ç»œ
sudo zerotier-cli join ä½ çš„NetworkID

# åœ¨ZeroTierç½‘ç«™æ‰¹å‡†è®¾å¤‡
```

4. **é…ç½®**
   - æ ‘è“æ´¾ä¼šè·å¾—ä¸€ä¸ªè™šæ‹ŸIPï¼ˆå¦‚ï¼š10.147.x.xï¼‰
   - åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªIPè®¿é—®

---

## ğŸ¯ æ¨èæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš¾åº¦ | æˆæœ¬ | ç¨³å®šæ€§ | æ¨èåº¦ |
|------|------|------|--------|--------|
| ç›´æ¥è¿è·¯ç”±å™¨ | â­ ç®€å• | å…è´¹ | â­â­â­â­â­ | â­â­â­â­â­ |
| Cloudflare Tunnel | â­â­ ä¸­ç­‰ | å…è´¹ | â­â­â­â­ | â­â­â­â­ |
| ZeroTier | â­â­ ä¸­ç­‰ | å…è´¹ | â­â­â­â­ | â­â­â­â­ |
| frp | â­â­â­ å¤æ‚ | éœ€è¦æœåŠ¡å™¨ | â­â­â­â­ | â­â­â­ |
| ngrok | â­ ç®€å• | å…è´¹ï¼ˆæœ‰é™åˆ¶ï¼‰ | â­â­â­ | â­â­â­ |
| ç”µè„‘è½¬å‘ | â­â­â­ å¤æ‚ | å…è´¹ | â­â­ | â­â­ |

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èï¼šç›´æ¥è¿è·¯ç”±å™¨ï¼‰

### æ­¥éª¤1ï¼šè¿æ¥æ ‘è“æ´¾åˆ°è·¯ç”±å™¨

**æœ‰çº¿è¿æ¥ï¼š**
```
1. ç”¨ç½‘çº¿è¿æ¥æ ‘è“æ´¾å’Œè·¯ç”±å™¨
2. ç­‰å¾…è‡ªåŠ¨è·å–IP
```

**æ— çº¿è¿æ¥ï¼š**
```bash
# åœ¨æ ‘è“æ´¾ä¸Š
sudo raspi-config
# System Options â†’ Wireless LAN
# è¾“å…¥WiFiåç§°å’Œå¯†ç 
```

### æ­¥éª¤2ï¼šè·å–æ ‘è“æ´¾IP

```bash
# åœ¨æ ‘è“æ´¾ä¸Š
hostname -I

# æˆ–æŸ¥çœ‹è·¯ç”±å™¨ç®¡ç†é¡µé¢
# è®¾å¤‡åˆ—è¡¨ä¸­æ‰¾åˆ° "raspberrypi"
```

### æ­¥éª¤3ï¼šé…ç½®è·¯ç”±å™¨ç«¯å£è½¬å‘

ç°åœ¨å¯ä»¥æ­£å¸¸é…ç½®äº†ï¼š
- å¤–éƒ¨ç«¯å£ï¼š80 â†’ å†…éƒ¨IPï¼šæ ‘è“æ´¾IP â†’ å†…éƒ¨ç«¯å£ï¼š80
- å¤–éƒ¨ç«¯å£ï¼š443 â†’ å†…éƒ¨IPï¼šæ ‘è“æ´¾IP â†’ å†…éƒ¨ç«¯å£ï¼š443

### æ­¥éª¤4ï¼šç»§ç»­åŸŸåé…ç½®

```bash
# è¿è¡ŒåŸŸåé…ç½®è„šæœ¬
cd ~/Desktop/Github/RaspiOwnCloud
sudo bash scripts/setup_aliyun_domain.sh
```

## ğŸ’¡ å¦‚æœæ— æ³•ç›´æ¥è¿æ¥è·¯ç”±å™¨

å¦‚æœç¡®å®æ— æ³•å°†æ ‘è“æ´¾ç›´æ¥è¿æ¥åˆ°è·¯ç”±å™¨ï¼Œæ¨èä½¿ç”¨ **Cloudflare Tunnel** æ–¹æ¡ˆï¼Œå®ƒï¼š
- å®Œå…¨å…è´¹
- å¯ä»¥ä½¿ç”¨è‡ªå·±çš„åŸŸå
- ä¸éœ€è¦å…¬ç½‘IP
- ä¸éœ€è¦ç«¯å£è½¬å‘

éœ€è¦æˆ‘å¸®ä½ é…ç½® Cloudflare Tunnel å—ï¼Ÿ




