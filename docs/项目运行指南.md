# RaspberryCloud é¡¹ç›®è¿è¡ŒæŒ‡å—

å®Œæ•´çš„é¡¹ç›®è¿è¡Œæ–¹æ³•ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åœ¨æ ‘è“æ´¾ä¸Šè¿è¡Œï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨systemdæœåŠ¡ï¼ˆæ¨èï¼Œå¼€æœºè‡ªå¯ï¼‰

```bash
# 1. å¯åŠ¨æœåŠ¡
sudo systemctl start raspberrycloud

# 2. æ£€æŸ¥çŠ¶æ€
sudo systemctl status raspberrycloud

# 3. æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u raspberrycloud -f

# 4. è®¿é—®
# æµè§ˆå™¨æ‰“å¼€: http://æ ‘è“æ´¾IP
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆæµ‹è¯•/è°ƒè¯•ç”¨ï¼‰

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd /opt/raspberrycloud/backend

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source /opt/raspberrycloud/venv/bin/activate

# 3. å¯åŠ¨æœåŠ¡
uvicorn main:app --host 0.0.0.0 --port 8000 --reload

# 4. è®¿é—®
# åç«¯API: http://æ ‘è“æ´¾IP:8000
# Webç•Œé¢: http://æ ‘è“æ´¾IP (é€šè¿‡Nginx)
```

#### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
# ä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬
cd ~/Desktop/Github/RaspiOwnCloud
chmod +x scripts/start.sh
sudo bash scripts/start.sh
```

### åœ¨æœ¬åœ°Windowsä¸Šè¿è¡Œï¼ˆå¼€å‘ç¯å¢ƒï¼‰

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
.\scripts\start.bat
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```powershell
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
python -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\activate

# 4. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 5. åˆ›å»º.envé…ç½®æ–‡ä»¶
copy ..\config\env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œä¿®æ”¹å­˜å‚¨è·¯å¾„ç­‰é…ç½®

# 6. åˆå§‹åŒ–æ•°æ®åº“
python -c "from models import init_db; init_db()"

# 7. å¯åŠ¨æœåŠ¡
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## ğŸ“‹ è¯¦ç»†è¿è¡Œæ­¥éª¤

### ç”Ÿäº§ç¯å¢ƒè¿è¡Œï¼ˆæ ‘è“æ´¾ï¼‰

#### å‰ç½®æ¡ä»¶æ£€æŸ¥

```bash
# 1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²å®‰è£…
sudo systemctl status raspberrycloud

# 2. æ£€æŸ¥Nginxæ˜¯å¦è¿è¡Œ
sudo systemctl status nginx

# 3. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
sudo lsof -i :8000
sudo lsof -i :80
```

#### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯æœåŠ¡
sudo systemctl start raspberrycloud

# å¯åŠ¨Nginxï¼ˆå¦‚æœæœªè¿è¡Œï¼‰
sudo systemctl start nginx

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable raspberrycloud
sudo systemctl enable nginx
```

#### éªŒè¯è¿è¡Œ

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status raspberrycloud
sudo systemctl status nginx

# 2. æµ‹è¯•åç«¯API
curl http://localhost:8000/api/health
# åº”è¯¥è¿”å›: {"status":"healthy","version":"1.0.0"}

# 3. æµ‹è¯•é€šè¿‡Nginxè®¿é—®
curl http://localhost/api/health

# 4. è·å–è®¿é—®åœ°å€
hostname -I
# ä½¿ç”¨è¿”å›çš„IPè®¿é—®: http://æ ‘è“æ´¾IP
```

#### è®¿é—®Webç•Œé¢

1. **å±€åŸŸç½‘è®¿é—®**
   - æµè§ˆå™¨æ‰“å¼€ï¼š`http://æ ‘è“æ´¾IP`
   - ä¾‹å¦‚ï¼š`http://192.168.1.100`

2. **ç™»å½•**
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`RaspberryCloud2024!`
   - âš ï¸ é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç 

### å¼€å‘ç¯å¢ƒè¿è¡Œï¼ˆæœ¬åœ°Windowsï¼‰

#### ç¯å¢ƒå‡†å¤‡

```powershell
# 1. æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦3.11+ï¼‰
python --version

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd F:\Github\RaspiOwnCloud\backend

# 3. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 4. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\activate
```

#### å®‰è£…ä¾èµ–

```powershell
# å‡çº§pip
python -m pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

#### é…ç½®ç¯å¢ƒå˜é‡

```powershell
# 1. å¤åˆ¶é…ç½®æ¨¡æ¿
copy ..\config\env.example .env

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
notepad .env
```

**Windowsç¯å¢ƒé…ç½®ç¤ºä¾‹ï¼š**

```bash
# æ•°æ®åº“é…ç½®ï¼ˆSQLiteï¼‰
DATABASE_URL=sqlite:///./raspberrycloud.db

# å­˜å‚¨è·¯å¾„é…ç½®ï¼ˆWindowsæ ¼å¼ï¼‰
STORAGE_PATH=C:\temp\raspberrycloud\storage\users
SHARE_PATH=C:\temp\raspberrycloud\storage\shares
TEMP_PATH=C:\temp\raspberrycloud\storage\temp
BACKUP_PATH=C:\temp\raspberrycloud\storage\backups

# ç”Ÿæˆå¯†é’¥
SECRET_KEY=ä½ çš„éšæœºå¯†é’¥ï¼ˆè¿è¡Œ: openssl rand -hex 32ï¼‰
```

#### åˆå§‹åŒ–æ•°æ®åº“

```powershell
# åˆå§‹åŒ–æ•°æ®åº“
python -c "from models import init_db; init_db()"
```

#### å¯åŠ¨æœåŠ¡

```powershell
# æ–¹æ³•1ï¼šç›´æ¥è¿è¡Œ
uvicorn main:app --host 0.0.0.0 --port 8000 --reload

# æ–¹æ³•2ï¼šä½¿ç”¨Pythonè¿è¡Œ
python main.py
```

#### è®¿é—®æœåŠ¡

- **åç«¯API**: `http://localhost:8000`
- **APIæ–‡æ¡£**: `http://localhost:8000/api/docs`ï¼ˆå¦‚æœDEBUG=trueï¼‰
- **å‰ç«¯ç•Œé¢**: éœ€è¦å•ç‹¬å¯åŠ¨å‰ç«¯æœåŠ¡å™¨æˆ–ä½¿ç”¨Nginx

## ğŸ”§ è¿è¡Œæ¨¡å¼è¯´æ˜

### å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰

```bash
# ä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡å¯
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### ç”Ÿäº§æ¨¡å¼ï¼ˆå¤šè¿›ç¨‹ï¼‰

```bash
# ä½¿ç”¨å¤šä¸ªworkerè¿›ç¨‹
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 2
```

### è°ƒè¯•æ¨¡å¼ï¼ˆè¯¦ç»†æ—¥å¿—ï¼‰

```bash
# å¯ç”¨DEBUGæ¨¡å¼
# åœ¨.envä¸­è®¾ç½®: DEBUG=true
uvicorn main:app --host 0.0.0.0 --port 8000 --log-level debug
```

## ğŸ“Š æœåŠ¡ç®¡ç†å‘½ä»¤

### systemdæœåŠ¡ç®¡ç†ï¼ˆæ ‘è“æ´¾ï¼‰

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start raspberrycloud

# åœæ­¢æœåŠ¡
sudo systemctl stop raspberrycloud

# é‡å¯æœåŠ¡
sudo systemctl restart raspberrycloud

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status raspberrycloud

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u raspberrycloud -f

# æŸ¥çœ‹æœ€è¿‘50æ¡æ—¥å¿—
sudo journalctl -u raspberrycloud -n 50

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable raspberrycloud

# å–æ¶ˆå¼€æœºè‡ªå¯
sudo systemctl disable raspberrycloud
```

### æ‰‹åŠ¨è¿è¡Œç®¡ç†

```bash
# å¯åŠ¨ï¼ˆå‰å°è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—ï¼‰
cd /opt/raspberrycloud/backend
source /opt/raspberrycloud/venv/bin/activate
uvicorn main:app --host 0.0.0.0 --port 8000

# åå°è¿è¡Œ
nohup uvicorn main:app --host 0.0.0.0 --port 8000 > /tmp/raspberrycloud.log 2>&1 &

# åœæ­¢åå°è¿›ç¨‹
ps aux | grep uvicorn
kill <PID>
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u raspberrycloud -n 50 --no-pager

# æ‰‹åŠ¨å¯åŠ¨æŸ¥çœ‹é”™è¯¯
cd /opt/raspberrycloud/backend
source /opt/raspberrycloud/venv/bin/activate
uvicorn main:app --host 0.0.0.0 --port 8000
```

### Q2: ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹å ç”¨8000ç«¯å£çš„è¿›ç¨‹
sudo lsof -i :8000

# æ€æ­»è¿›ç¨‹
sudo kill -9 <PID>
```

### Q3: æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
ls -la /opt/raspberrycloud/raspberrycloud.db

# æ£€æŸ¥.envé…ç½®
cat /opt/raspberrycloud/.env | grep DATABASE_URL
```

### Q4: æƒé™é—®é¢˜

```bash
# ä¿®å¤æƒé™
sudo chown -R www-data:www-data /opt/raspberrycloud
sudo chmod -R 755 /opt/raspberrycloud
```

## âœ… è¿è¡Œæ£€æŸ¥æ¸…å•

- [ ] Pythonè™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
- [ ] ä¾èµ–å·²å®‰è£…ï¼ˆpip install -r requirements.txtï¼‰
- [ ] .envé…ç½®æ–‡ä»¶å·²åˆ›å»ºå¹¶é…ç½®
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–
- [ ] å­˜å‚¨ç›®å½•å·²åˆ›å»º
- [ ] æœåŠ¡å¯ä»¥å¯åŠ¨
- [ ] APIå¯ä»¥è®¿é—®ï¼ˆ/api/healthï¼‰
- [ ] Webç•Œé¢å¯ä»¥è®¿é—®
- [ ] å¯ä»¥ç™»å½•

## ğŸ¯ å¿«é€ŸéªŒè¯

è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯é¡¹ç›®æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

```bash
# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status raspberrycloud

# 2. æµ‹è¯•API
curl http://localhost:8000/api/health

# 3. æµ‹è¯•ç™»å½•
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"RaspberryCloud2024!"}'

# 4. è®¿é—®Webç•Œé¢
# æµè§ˆå™¨æ‰“å¼€: http://æ ‘è“æ´¾IP
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿéƒ¨ç½²æ•™ç¨‹](02-ç³»ç»Ÿéƒ¨ç½²æ•™ç¨‹.md) - å®Œæ•´çš„éƒ¨ç½²æ­¥éª¤
- [æ‰‹åŠ¨éƒ¨ç½²å‘½ä»¤](æ‰‹åŠ¨éƒ¨ç½²å‘½ä»¤.md) - æ‰‹åŠ¨éƒ¨ç½²çš„è¯¦ç»†å‘½ä»¤
- [é—®é¢˜æ’æŸ¥æ‰‹å†Œ](05-é—®é¢˜æ’æŸ¥æ‰‹å†Œ.md) - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ


