# ç¬”è®°æœ¬ç½‘ç»œç¯å¢ƒåŸŸåé…ç½®å®Œæ•´æŒ‡å—

é€‚ç”¨äºæ ‘è“æ´¾é€šè¿‡ç¬”è®°æœ¬è¿æ¥ç½‘ç»œï¼Œä½¿ç”¨é˜¿é‡Œäº‘åŸŸåçš„å®Œæ•´é…ç½®æµç¨‹ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

- âœ… å·²è´­ä¹°é˜¿é‡Œäº‘åŸŸå
- âœ… æ ‘è“æ´¾å·²é€šè¿‡ç¬”è®°æœ¬è¿æ¥ç½‘ç»œï¼ˆWiFiçƒ­ç‚¹æˆ–åŒä¸€å±€åŸŸç½‘ï¼‰
- âœ… æ ‘è“æ´¾ä¸Šå·²éƒ¨ç½²RaspberryCloudæœåŠ¡
- âœ… ç¬”è®°æœ¬å¯ä»¥æ­£å¸¸ä¸Šç½‘

## ğŸ” ç¬¬ä¸€æ­¥ï¼šåˆ¤æ–­ç½‘ç»œç¯å¢ƒ

é¦–å…ˆéœ€è¦åˆ¤æ–­ä½ çš„ç½‘ç»œç¯å¢ƒï¼Œé€‰æ‹©å¯¹åº”çš„é…ç½®æ–¹æ¡ˆã€‚

### æ£€æŸ¥ç¬”è®°æœ¬æ˜¯å¦æœ‰å…¬ç½‘IP

åœ¨ç¬”è®°æœ¬ä¸Šæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ä»¥ä¸‹ä»»ä¸€ç½‘ç«™æŸ¥çœ‹IPï¼š
- https://ip.sb
- https://www.ip138.com
- https://ifconfig.me

**åˆ¤æ–­æ ‡å‡†ï¼š**
- å¦‚æœæ˜¾ç¤ºçš„IPæ˜¯ `10.x.x.x`ã€`172.16-31.x.x` æˆ– `192.168.x.x` â†’ **å†…ç½‘IP**ï¼Œä½¿ç”¨æ–¹æ¡ˆäºŒï¼ˆå†…ç½‘ç©¿é€ï¼‰
- å¦‚æœæ˜¾ç¤ºçš„IPæ˜¯å…¶ä»–æ ¼å¼ï¼ˆå¦‚ `123.45.67.89`ï¼‰â†’ **å¯èƒ½æ˜¯å…¬ç½‘IP**ï¼Œå…ˆå°è¯•æ–¹æ¡ˆä¸€ï¼ˆç«¯å£è½¬å‘ï¼‰

---

## ğŸš€ æ–¹æ¡ˆä¸€ï¼šæœ‰å…¬ç½‘IPï¼ˆæ¨èï¼‰

å¦‚æœä½ çš„ç¬”è®°æœ¬æœ‰å…¬ç½‘IPï¼Œå¯ä»¥é€šè¿‡è·¯ç”±å™¨ç«¯å£è½¬å‘å®ç°å¤–ç½‘è®¿é—®ã€‚

### æ­¥éª¤1ï¼šè·å–æ ‘è“æ´¾å†…ç½‘IP

åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œï¼š

```bash
hostname -I
# æˆ–
ip addr show | grep "inet " | grep -v 127.0.0.1
```

è®°å½•æ ‘è“æ´¾çš„IPåœ°å€ï¼Œä¾‹å¦‚ï¼š`192.168.137.100`

### æ­¥éª¤2ï¼šé…ç½®ç¬”è®°æœ¬ç«¯å£è½¬å‘

#### 2.1 Windowsç¬”è®°æœ¬é…ç½®ç«¯å£è½¬å‘

**æ–¹æ³•Aï¼šä½¿ç”¨Windowsè‡ªå¸¦çš„ç«¯å£è½¬å‘ï¼ˆæ¨èï¼‰**

1. **ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€PowerShell**

2. **æŸ¥çœ‹ç½‘ç»œè¿æ¥ä¿¡æ¯**
```powershell
# æŸ¥çœ‹ç½‘ç»œé€‚é…å™¨
Get-NetAdapter
# è®°å½•è¿æ¥æ ‘è“æ´¾çš„é€‚é…å™¨åç§°ï¼Œä¾‹å¦‚ï¼šä»¥å¤ªç½‘ã€WLANç­‰
```

3. **é…ç½®ç«¯å£è½¬å‘è§„åˆ™**
```powershell
# æ·»åŠ 80ç«¯å£è½¬å‘ï¼ˆHTTPï¼‰
netsh interface portproxy add v4tov4 listenport=80 listenaddress=0.0.0.0 connectport=80 connectaddress=æ ‘è“æ´¾IP

# æ·»åŠ 443ç«¯å£è½¬å‘ï¼ˆHTTPSï¼‰
netsh interface portproxy add v4tov4 listenport=443 listenaddress=0.0.0.0 connectport=443 connectaddress=æ ‘è“æ´¾IP

# ç¤ºä¾‹ï¼ˆæ ‘è“æ´¾IPä¸º192.168.137.100ï¼‰ï¼š
netsh interface portproxy add v4tov4 listenport=80 listenaddress=0.0.0.0 connectport=80 connectaddress=192.168.137.51
netsh interface portproxy add v4tov4 listenport=443 listenaddress=0.0.0.0 connectport=443 connectaddress=192.168.137.51
```

4. **é…ç½®Windowsé˜²ç«å¢™**
```powershell
# å…è®¸80ç«¯å£å…¥ç«™
New-NetFirewallRule -DisplayName "RaspberryCloud HTTP" -Direction Inbound -LocalPort 80 -Protocol TCP -Action Allow

# å…è®¸443ç«¯å£å…¥ç«™
New-NetFirewallRule -DisplayName "RaspberryCloud HTTPS" -Direction Inbound -LocalPort 443 -Protocol TCP -Action Allow
```

5. **éªŒè¯ç«¯å£è½¬å‘**
```powershell
# æŸ¥çœ‹æ‰€æœ‰ç«¯å£è½¬å‘è§„åˆ™
netsh interface portproxy show all
```

**æ–¹æ³•Bï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¦‚NATAPPã€ngrokï¼‰**

å¦‚æœWindowsç«¯å£è½¬å‘é…ç½®å¤æ‚ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ï¼ˆè§æ–¹æ¡ˆäºŒï¼‰ã€‚

#### 2.2 å¦‚æœç¬”è®°æœ¬è¿æ¥äº†è·¯ç”±å™¨

å¦‚æœä½ çš„ç¬”è®°æœ¬é€šè¿‡è·¯ç”±å™¨è¿æ¥ç½‘ç»œï¼Œéœ€è¦åœ¨è·¯ç”±å™¨ä¸­é…ç½®ç«¯å£è½¬å‘ï¼š

1. **ç™»å½•è·¯ç”±å™¨ç®¡ç†ç•Œé¢**
   - é€šå¸¸è®¿é—®ï¼š`192.168.1.1` æˆ– `192.168.0.1`
   - è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç 

2. **æ‰¾åˆ°ç«¯å£è½¬å‘/è™šæ‹ŸæœåŠ¡å™¨è®¾ç½®**
   - TP-Link: åº”ç”¨ç®¡ç† â†’ è™šæ‹ŸæœåŠ¡å™¨
   - åä¸º: å®‰å…¨è®¾ç½® â†’ è™šæ‹ŸæœåŠ¡å™¨
   - å°ç±³: é«˜çº§è®¾ç½® â†’ ç«¯å£è½¬å‘
   - åç¡•: é«˜çº§è®¾ç½® â†’ ç«¯å£è½¬å‘

3. **æ·»åŠ ç«¯å£è½¬å‘è§„åˆ™**

| è§„åˆ™åç§° | å¤–éƒ¨ç«¯å£ | å†…éƒ¨IP | å†…éƒ¨ç«¯å£ | åè®® |
|---------|---------|--------|---------|------|
| HTTP | 80 | æ ‘è“æ´¾IP | 80 | TCP |
| HTTPS | 443 | æ ‘è“æ´¾IP | 443 | TCP |

**æ³¨æ„ï¼š** å¦‚æœè¿è¥å•†å°ç¦80/443ç«¯å£ï¼Œä½¿ç”¨å…¶ä»–ç«¯å£ï¼ˆå¦‚8080/8443ï¼‰

### æ­¥éª¤3ï¼šè·å–ç¬”è®°æœ¬å…¬ç½‘IP

åœ¨ç¬”è®°æœ¬ä¸Šæ‰§è¡Œï¼š

```bash
# Windows PowerShell
Invoke-WebRequest -Uri "https://ip.sb" -UseBasicParsing | Select-Object -ExpandProperty Content

# æˆ–è®¿é—®ç½‘ç«™æŸ¥çœ‹
# https://ip.sb
# https://www.ip138.com
```

è®°å½•å…¬ç½‘IPåœ°å€ï¼Œä¾‹å¦‚ï¼š`123.45.67.89`

### æ­¥éª¤4ï¼šé…ç½®é˜¿é‡Œäº‘åŸŸåè§£æ

#### 4.1 ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°

1. è®¿é—®é˜¿é‡Œäº‘æ§åˆ¶å°ï¼šhttps://dns.console.aliyun.com
2. æˆ–ï¼šç™»å½•é˜¿é‡Œäº‘ â†’ æ§åˆ¶å° â†’ äº§å“ä¸æœåŠ¡ â†’ åŸŸå â†’ åŸŸåè§£æDNS

#### 4.2 åˆ¤æ–­IPç±»å‹

**é‡è¦ï¼š** å¦‚æœä½ çš„ç¬”è®°æœ¬ä½¿ç”¨äº†VPN/æ¢¯å­ï¼Œå…¬ç½‘IPä¼šç»å¸¸å˜åŒ–ï¼Œéœ€è¦ä½¿ç”¨**åŠ¨æ€DNSï¼ˆDDNSï¼‰**æ–¹æ¡ˆã€‚

**åˆ¤æ–­æ–¹æ³•ï¼š**
- âœ… **å›ºå®šIP**ï¼šæ¯æ¬¡æŸ¥çœ‹IPéƒ½ç›¸åŒ â†’ ä½¿ç”¨é™æ€Aè®°å½•ï¼ˆè§4.3ï¼‰
- âš ï¸ **åŠ¨æ€IP**ï¼šæ¯æ¬¡æŸ¥çœ‹IPéƒ½ä¸åŒï¼ˆå¦‚ä½¿ç”¨VPNï¼‰ â†’ ä½¿ç”¨DDNSè‡ªåŠ¨æ›´æ–°ï¼ˆè§4.4ï¼‰

#### 4.3 æ·»åŠ Aè®°å½•ï¼ˆå›ºå®šIPï¼Œé™æ€é…ç½®ï¼‰

å¦‚æœä½ çš„å…¬ç½‘IPæ˜¯å›ºå®šçš„ï¼Œå¯ä»¥æ‰‹åŠ¨é…ç½®ï¼š

1. åœ¨åŸŸååˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ°ä½ çš„åŸŸå
2. ç‚¹å‡»"è§£æè®¾ç½®"æˆ–"è§£æ"æŒ‰é’®
3. ç‚¹å‡»"æ·»åŠ è®°å½•"æŒ‰é’®

**å¡«å†™ä¿¡æ¯ï¼š**
- **è®°å½•ç±»å‹**ï¼šé€‰æ‹© `A`
- **ä¸»æœºè®°å½•**ï¼šè¾“å…¥ `@`ï¼ˆè¡¨ç¤ºä¸»åŸŸåï¼‰
- **è®°å½•å€¼**ï¼šè¾“å…¥ä½ çš„å…¬ç½‘IPï¼ˆå¦‚ï¼š`123.45.67.89`ï¼‰
- **TTL**ï¼šè¾“å…¥ `600`ï¼ˆ10åˆ†é’Ÿï¼Œæˆ–ä½¿ç”¨é»˜è®¤å€¼ï¼‰
- **è§£æçº¿è·¯**ï¼šé€‰æ‹©"é»˜è®¤"ï¼ˆæˆ–æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼‰

4. ç‚¹å‡»"ç¡®è®¤"ä¿å­˜

**æ·»åŠ wwwå­åŸŸåï¼š**

é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œæ·»åŠ ç¬¬äºŒæ¡è®°å½•ï¼š
- **ä¸»æœºè®°å½•**ï¼šè¾“å…¥ `www`
- **è®°å½•å€¼**ï¼šè¾“å…¥ä½ çš„å…¬ç½‘IPï¼ˆä¸ä¸»åŸŸåç›¸åŒï¼‰
- å…¶ä»–é…ç½®ç›¸åŒ

#### 4.4 é…ç½®åŠ¨æ€DNSï¼ˆåŠ¨æ€IPï¼Œæ¨èVPNç”¨æˆ·ï¼‰â­

å¦‚æœä½ çš„å…¬ç½‘IPä¼šå˜åŒ–ï¼ˆä½¿ç”¨VPN/æ¢¯å­ï¼‰ï¼Œéœ€è¦é…ç½®è‡ªåŠ¨æ›´æ–°ï¼š

##### æ­¥éª¤1ï¼šåˆ›å»ºRAMå­è´¦å·ï¼ˆæ¨èï¼Œæ›´å®‰å…¨ï¼‰â­

**âš ï¸ å®‰å…¨æç¤ºï¼š** å¼ºçƒˆå»ºè®®ä½¿ç”¨RAMå­è´¦å·ï¼Œè€Œä¸æ˜¯ä¸»è´¦å·AccessKeyï¼

**ä¸ºä»€ä¹ˆä½¿ç”¨RAMå­è´¦å·ï¼Ÿ**
- âœ… **æœ€å°æƒé™åŸåˆ™**ï¼šåªæˆäºˆDNSç®¡ç†æƒé™ï¼Œå³ä½¿æ³„éœ²ä¹Ÿåªèƒ½æ“ä½œDNS
- âœ… **å®‰å…¨éš”ç¦»**ï¼šä¸å½±å“ä¸»è´¦å·å’Œå…¶ä»–æœåŠ¡
- âœ… **æ˜“äºç®¡ç†**ï¼šå¯ä»¥éšæ—¶ç¦ç”¨ï¼Œä¸å½±å“ä¸»è´¦å·ä½¿ç”¨

**æ­¥éª¤ï¼š**

1. **ç™»å½•RAMæ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://ram.console.aliyun.com
   - æˆ–ï¼šæ§åˆ¶å° â†’ äº§å“ä¸æœåŠ¡ â†’ è®¿é—®æ§åˆ¶ï¼ˆRAMï¼‰

2. **åˆ›å»ºRAMç”¨æˆ·**
   - ç‚¹å‡»å·¦ä¾§"ç”¨æˆ·" â†’ "åˆ›å»ºç”¨æˆ·"
   - **ç™»å½•åç§°**ï¼šè¾“å…¥ `ddns-user`ï¼ˆæˆ–è‡ªå®šä¹‰ï¼‰
   - **æ˜¾ç¤ºåç§°**ï¼šè¾“å…¥ `DDNSæ›´æ–°ç”¨æˆ·`ï¼ˆæˆ–è‡ªå®šä¹‰ï¼‰
   - **è®¿é—®æ–¹å¼**ï¼šå‹¾é€‰"ç¼–ç¨‹è®¿é—®"ï¼ˆä¼šç”ŸæˆAccessKeyï¼‰
   - ç‚¹å‡»"ç¡®å®š"

3. **ä¿å­˜AccessKeyä¿¡æ¯**
   - åˆ›å»ºæˆåŠŸåï¼Œä¼šæ˜¾ç¤ºAccessKey IDå’ŒSecret
   - **ç«‹å³ä¿å­˜**ï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼ï¼‰
   - AccessKey IDï¼š`LTAI5t...`
   - AccessKey Secretï¼š`xxxx...`

4. **æˆäºˆDNSç®¡ç†æƒé™**
   - åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ°åˆšåˆ›å»ºçš„ç”¨æˆ·
   - ç‚¹å‡»"æ·»åŠ æƒé™"
   - é€‰æ‹©"AliyunDNSFullAccess"ï¼ˆDNSå®Œå…¨ç®¡ç†æƒé™ï¼‰
   - æˆ–é€‰æ‹©"AliyunDNSReadOnlyAccess"ï¼ˆåªè¯»ï¼‰+ è‡ªå®šä¹‰ç­–ç•¥ï¼ˆä»…å…è®¸æ›´æ–°DNSè®°å½•ï¼‰
   - ç‚¹å‡»"ç¡®å®š"

5. **éªŒè¯æƒé™**
   - ç¡®ä¿ç”¨æˆ·å·²æ‹¥æœ‰DNSç®¡ç†æƒé™
   - å¯ä»¥æµ‹è¯•ä½¿ç”¨è¯¥AccessKeyè°ƒç”¨DNS API

**æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ä¸»è´¦å·AccessKeyï¼ˆä¸æ¨èï¼‰**

å¦‚æœä¸æƒ³åˆ›å»ºRAMå­è´¦å·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸»è´¦å·AccessKeyï¼š

1. **ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://ram.console.aliyun.com/manage/ak
   - æˆ–ï¼šæ§åˆ¶å° â†’ å³ä¸Šè§’å¤´åƒ â†’ AccessKeyç®¡ç†

2. **åˆ›å»ºAccessKey**
   - ç‚¹å‡»"åˆ›å»ºAccessKey"
   - æŒ‰æç¤ºå®Œæˆèº«ä»½éªŒè¯ï¼ˆæ‰‹æœºéªŒè¯ç ï¼‰
   - **ç«‹å³ä¿å­˜** AccessKey ID å’Œ AccessKey Secretï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼ï¼‰

3. **è®°å½•ä¿¡æ¯**
   - AccessKey IDï¼š`LTAI5t...`
   - AccessKey Secretï¼š`xxxx...`

**âš ï¸ å®‰å…¨è­¦å‘Šï¼š**
- ä¸»è´¦å·AccessKeyæ‹¥æœ‰è´¦æˆ·çš„å®Œå…¨æƒé™
- å¦‚æœæ³„éœ²ï¼Œå¯èƒ½å¯¼è‡´æ•´ä¸ªè´¦æˆ·è¢«æ§åˆ¶
- å»ºè®®å®šæœŸè½®æ¢AccessKey
- ä¸è¦å°†AccessKeyæäº¤åˆ°ä»£ç ä»“åº“

##### æ­¥éª¤2ï¼šé¦–æ¬¡æ·»åŠ DNSè®°å½•ï¼ˆæ‰‹åŠ¨ï¼‰

å³ä½¿ä½¿ç”¨DDNSï¼Œä¹Ÿéœ€è¦å…ˆæ‰‹åŠ¨æ·»åŠ ä¸€æ¡Aè®°å½•ï¼š

1. åœ¨é˜¿é‡Œäº‘DNSæ§åˆ¶å°æ·»åŠ Aè®°å½•
2. **ä¸»æœºè®°å½•**ï¼š`@` æˆ– `www`
3. **è®°å½•å€¼**ï¼šå¯ä»¥æš‚æ—¶å¡«å†™ä»»æ„IPï¼ˆå¦‚ï¼š`1.1.1.1`ï¼‰ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–°
4. **TTL**ï¼š`600`ï¼ˆ10åˆ†é’Ÿï¼‰
5. ç‚¹å‡»"ç¡®è®¤"ä¿å­˜

##### æ­¥éª¤3ï¼šé…ç½®è‡ªåŠ¨æ›´æ–°è„šæœ¬

**åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œï¼š**

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/Desktop/Github/RaspiOwnCloud

# 2. ç¼–è¾‘æ›´æ–°è„šæœ¬
nano scripts/update_aliyun_dns.sh
```

**ä¿®æ”¹é…ç½®ä¿¡æ¯ï¼š**

```bash
# æ‰¾åˆ°ä»¥ä¸‹è¡Œå¹¶ä¿®æ”¹ä¸ºä½ çš„å®é™…å€¼
export ALIYUN_ACCESS_KEY_ID="ä½ çš„AccessKey ID"
export ALIYUN_ACCESS_KEY_SECRET="ä½ çš„AccessKey Secret"
export ALIYUN_DOMAIN="ä½ çš„åŸŸå.com"  # ä¾‹å¦‚: example.com
export ALIYUN_SUBDOMAIN="@"  # @ è¡¨ç¤ºä¸»åŸŸåï¼Œwww è¡¨ç¤ºwwwå­åŸŸå
```

**ä¿å­˜å¹¶è®¾ç½®æ‰§è¡Œæƒé™ï¼š**

```bash
chmod +x scripts/update_aliyun_dns.sh
chmod +x scripts/update_aliyun_dns.py
```

##### æ­¥éª¤4ï¼šæµ‹è¯•è„šæœ¬

```bash
# æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡ï¼Œæµ‹è¯•æ˜¯å¦æ­£å¸¸
bash scripts/update_aliyun_dns.sh
```

**é¢„æœŸè¾“å‡ºï¼š**
```
[2024-12-08 12:00:00] æ­£åœ¨è·å–å½“å‰å…¬ç½‘IP...
[INFO] å½“å‰å…¬ç½‘IP: 123.45.67.89
[INFO] æ­£åœ¨æŸ¥è¯¢DNSè®°å½•: @.example.com
[INFO] DNSè®°å½•å½“å‰IP: 1.1.1.1
[INFO] IPå·²å˜åŒ–ï¼Œæ­£åœ¨æ›´æ–°DNSè®°å½•...
[SUCCESS] DNSè®°å½•å·²æ›´æ–°: @.example.com -> 123.45.67.89
```

##### æ­¥éª¤5ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰

```bash
# ç¼–è¾‘crontab
crontab -e
```

**æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰ï¼š**

```bash
# é˜¿é‡Œäº‘DNSè‡ªåŠ¨æ›´æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰
*/5 * * * * /home/pi/Desktop/Github/RaspiOwnCloud/scripts/update_aliyun_dns.sh >/dev/null 2>&1
```

**æˆ–è€…æ›´é¢‘ç¹ï¼ˆæ¯2åˆ†é’Ÿï¼‰ï¼š**

```bash
*/2 * * * * /home/pi/Desktop/Github/RaspiOwnCloud/scripts/update_aliyun_dns.sh >/dev/null 2>&1
```

**ä¿å­˜å¹¶é€€å‡º**ï¼ˆnano: Ctrl+O, Enter, Ctrl+Xï¼‰

##### æ­¥éª¤6ï¼šéªŒè¯è‡ªåŠ¨æ›´æ–°

```bash
# æŸ¥çœ‹cronæ—¥å¿—ï¼ˆå¦‚æœå¯ç”¨ï¼‰
grep CRON /var/log/syslog | tail -5

# æŸ¥çœ‹è„šæœ¬æ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰
tail -f /var/log/aliyun_dns_update.log

# æ‰‹åŠ¨æ£€æŸ¥DNSè®°å½•
nslookup ä½ çš„åŸŸå.com
```

**é¢„æœŸç»“æœï¼š**
- DNSè®°å½•åº”è¯¥æ˜¾ç¤ºä½ å½“å‰çš„å®é™…å…¬ç½‘IP
- å½“IPå˜åŒ–æ—¶ï¼ŒDNSè®°å½•ä¼šåœ¨5åˆ†é’Ÿå†…è‡ªåŠ¨æ›´æ–°

##### æ­¥éª¤7ï¼šé…ç½®å¤šä¸ªå­åŸŸåï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åŒæ—¶æ›´æ–° `@` å’Œ `www` ä¸¤ä¸ªè®°å½•ï¼Œå¯ä»¥ï¼š

**æ–¹æ³•1ï¼šåˆ›å»ºä¸¤ä¸ªå®šæ—¶ä»»åŠ¡**

```bash
crontab -e
```

æ·»åŠ ä¸¤è¡Œï¼š

```bash
# æ›´æ–°ä¸»åŸŸå
*/5 * * * * ALIYUN_SUBDOMAIN="@" /home/pi/Desktop/Github/RaspiOwnCloud/scripts/update_aliyun_dns.sh >/dev/null 2>&1

# æ›´æ–°wwwå­åŸŸå
*/5 * * * * ALIYUN_SUBDOMAIN="www" /home/pi/Desktop/Github/RaspiOwnCloud/scripts/update_aliyun_dns.sh >/dev/null 2>&1
```

**æ–¹æ³•2ï¼šä¿®æ”¹è„šæœ¬æ”¯æŒå¤šä¸ªåŸŸå**

å¯ä»¥ä¿®æ”¹è„šæœ¬ï¼Œåœ¨é…ç½®ä¸­æŒ‡å®šå¤šä¸ªå­åŸŸåï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–°æ‰€æœ‰è®°å½•ã€‚

#### 4.4 éªŒè¯DNSè§£æ

**ç­‰å¾…DNSç”Ÿæ•ˆï¼š**
- é€šå¸¸5-30åˆ†é’Ÿç”Ÿæ•ˆ
- æœ€é•¿å¯èƒ½éœ€è¦48å°æ—¶ï¼ˆä½†ä¸€èˆ¬å¾ˆå¿«ï¼‰

**éªŒè¯æ–¹æ³•ï¼š**

åœ¨ç¬”è®°æœ¬æˆ–æ ‘è“æ´¾ä¸Šæ‰§è¡Œï¼š

```bash
# Windows PowerShell
nslookup ä½ çš„åŸŸå.com

# Linux/æ ‘è“æ´¾
nslookup ä½ çš„åŸŸå.com
# æˆ–
dig ä½ çš„åŸŸå.com
```

**é¢„æœŸç»“æœï¼š**
- åº”è¯¥è¿”å›ä½ é…ç½®çš„å…¬ç½‘IPåœ°å€
- å¦‚æœè¿”å›çš„ä¸æ˜¯ä½ çš„å…¬ç½‘IPï¼Œè¯´æ˜DNSè¿˜æœªç”Ÿæ•ˆï¼Œè¯·ç­‰å¾…

**åœ¨çº¿éªŒè¯å·¥å…·ï¼š**
- https://dnschecker.org
- https://www.whatsmydns.net

### æ­¥éª¤5ï¼šé…ç½®æ ‘è“æ´¾Nginx

åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œï¼š

```bash
# ç¼–è¾‘Nginxé…ç½®
sudo nano /etc/nginx/sites-available/raspberrycloud
```

**æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼š**
```nginx
server_name _;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåï¼Œå¦‚: cloud.example.com
```

**ä¿®æ”¹ä¸ºï¼š**
```nginx
server_name ä½ çš„åŸŸå.com www.ä½ çš„åŸŸå.com;
```

**å®Œæ•´ç¤ºä¾‹ï¼ˆå‡è®¾åŸŸåä¸º mycloud.comï¼‰ï¼š**
```nginx
server_name mycloud.com www.mycloud.com;
```

**ä¿å­˜æ–‡ä»¶ï¼š**
- æŒ‰ `Ctrl+O` ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤
- æŒ‰ `Ctrl+X` é€€å‡º

**æµ‹è¯•å¹¶é‡è½½ï¼š**

```bash
# æµ‹è¯•Nginxé…ç½®è¯­æ³•
sudo nginx -t

# å¦‚æœæ˜¾ç¤º "syntax is ok" å’Œ "test is successful"ï¼Œç»§ç»­ä¸‹ä¸€æ­¥
# å¦‚æœæœ‰é”™è¯¯ï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„åŸŸåæ˜¯å¦æ­£ç¡®

# é‡è½½Nginxé…ç½®ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
sudo systemctl reload nginx

# æˆ–è€…é‡å¯Nginxï¼ˆä¼šçŸ­æš‚ä¸­æ–­æœåŠ¡ï¼‰
sudo systemctl restart nginx
```

### æ­¥éª¤6ï¼šé…ç½®HTTPSï¼ˆSSLè¯ä¹¦ï¼‰

#### 6.1 å®‰è£…Certbot

åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œï¼š

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£…Certbotå’ŒNginxæ’ä»¶
sudo apt install -y certbot python3-certbot-nginx

# éªŒè¯å®‰è£…
certbot --version
```

#### 6.2 ç”³è¯·SSLè¯ä¹¦

**é‡è¦å‰æï¼š**
- âœ… åŸŸåå·²æ­£ç¡®è§£æåˆ°ä½ çš„å…¬ç½‘IPï¼ˆæ­¥éª¤4å·²å®Œæˆï¼‰
- âœ… 80ç«¯å£å·²æ˜ å°„å¹¶å¯è®¿é—®ï¼ˆæ­¥éª¤2å·²å®Œæˆï¼‰
- âœ… Nginxé…ç½®å·²æ›´æ–°ï¼ˆæ­¥éª¤5å·²å®Œæˆï¼‰

**ç”³è¯·è¯ä¹¦ï¼š**

```bash
# æ›¿æ¢ä¸ºä½ çš„å®é™…åŸŸå
sudo certbot --nginx -d ä½ çš„åŸŸå.com -d www.ä½ çš„åŸŸå.com
```

**äº¤äº’å¼æ“ä½œè¯´æ˜ï¼š**

1. **è¾“å…¥é‚®ç®±åœ°å€**
   ```
   Enter email address (used for urgent renewal and security notices)
   ```
   - è¾“å…¥ä½ çš„é‚®ç®±ï¼ˆç”¨äºè¯ä¹¦åˆ°æœŸæé†’ï¼‰
   - æŒ‰å›è½¦ç¡®è®¤

2. **åŒæ„æœåŠ¡æ¡æ¬¾**
   ```
   (A)gree/(C)ancel: A
   ```
   - è¾“å…¥ `A` å¹¶å›è½¦

3. **æ˜¯å¦æ¥æ”¶é‚®ä»¶é€šçŸ¥**
   ```
   (Y)es/(N)o: N
   ```
   - è¾“å…¥ `N` å¹¶å›è½¦ï¼ˆæ¨èï¼‰

4. **é€‰æ‹©é‡å®šå‘é€‰é¡¹**
   ```
   Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
   1: No redirect - Make no further changes to the webserver configuration.
   2: Redirect - Make all requests redirect to secure HTTPS access.
   Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2
   ```
   - è¾“å…¥ `2` å¹¶å›è½¦ï¼ˆæ¨èï¼šè‡ªåŠ¨å°†HTTPé‡å®šå‘åˆ°HTTPSï¼‰

**ç”³è¯·æˆåŠŸåï¼š**
- Certbotä¼šè‡ªåŠ¨ä¿®æ”¹Nginxé…ç½®
- è¯ä¹¦æ–‡ä»¶ä¿å­˜åœ¨ `/etc/letsencrypt/live/ä½ çš„åŸŸå.com/`
- Nginxä¼šè‡ªåŠ¨é‡è½½é…ç½®

#### 6.3 éªŒè¯è¯ä¹¦

```bash
# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
sudo certbot certificates

# æµ‹è¯•è¯ä¹¦ç»­æœŸï¼ˆä¸ä¼šçœŸæ­£ç»­æœŸï¼‰
sudo certbot renew --dry-run
```

#### 6.4 è®¾ç½®è‡ªåŠ¨ç»­æœŸ

Let's Encryptè¯ä¹¦æœ‰æ•ˆæœŸ90å¤©ï¼Œéœ€è¦å®šæœŸç»­æœŸã€‚è®¾ç½®è‡ªåŠ¨ç»­æœŸï¼š

```bash
# ç¼–è¾‘crontab
sudo crontab -e
```

**å¦‚æœé¦–æ¬¡ä½¿ç”¨ï¼Œé€‰æ‹©ç¼–è¾‘å™¨ï¼ˆæ¨èé€‰æ‹©nanoï¼‰ï¼š**
- è¾“å…¥ `1` é€‰æ‹© nano

**åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼š**
```cron
0 3 1 * * certbot renew --quiet && systemctl reload nginx
```

**è¯´æ˜ï¼š**
- `0 3 1 * *`ï¼šæ¯æœˆ1æ—¥å‡Œæ™¨3ç‚¹æ‰§è¡Œ
- `certbot renew --quiet`ï¼šé™é»˜ç»­æœŸï¼ˆåªåœ¨éœ€è¦æ—¶ç»­æœŸï¼‰
- `&& systemctl reload nginx`ï¼šç»­æœŸæˆåŠŸåé‡è½½Nginx

**ä¿å­˜å¹¶é€€å‡ºï¼š**
- æŒ‰ `Ctrl+O` ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤
- æŒ‰ `Ctrl+X` é€€å‡º

**éªŒè¯crontabï¼š**
```bash
# æŸ¥çœ‹crontabå†…å®¹
sudo crontab -l
```

### æ­¥éª¤7ï¼šé…ç½®æ ‘è“æ´¾é˜²ç«å¢™

```bash
# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# å¦‚æœä½¿ç”¨éæ ‡å‡†ç«¯å£
sudo ufw allow 8080/tcp
sudo ufw allow 8443/tcp
```

### æ­¥éª¤8ï¼šéªŒè¯è®¿é—®

1. **éªŒè¯DNSè§£æ**
```bash
# åœ¨æ ‘è“æ´¾æˆ–ç¬”è®°æœ¬ä¸Šæ‰§è¡Œ
nslookup ä½ çš„åŸŸå.com
# åº”è¯¥è¿”å›ä½ çš„å…¬ç½‘IP
```

2. **æµ‹è¯•è®¿é—®**
   - ä½¿ç”¨æ‰‹æœº4G/5Gç½‘ç»œï¼ˆå…³é—­WiFiï¼‰
   - æµè§ˆå™¨è®¿é—®ï¼š`https://ä½ çš„åŸŸå.com`
   - æ£€æŸ¥åœ°å€æ æ˜¯å¦æœ‰é”å›¾æ ‡ ğŸ”’

---

## ğŸŒ æ–¹æ¡ˆäºŒï¼šæ— å…¬ç½‘IPï¼ˆå†…ç½‘ç©¿é€ï¼‰

å¦‚æœä½ çš„ç¬”è®°æœ¬æ²¡æœ‰å…¬ç½‘IPï¼ˆæ ¡å›­ç½‘ã€å…¬å¸ç½‘ç»œç­‰ï¼‰ï¼Œéœ€è¦ä½¿ç”¨å†…ç½‘ç©¿é€ã€‚æ¨èä½¿ç”¨ **Cloudflare Tunnel**ï¼ˆå®Œå…¨å…è´¹ï¼‰ã€‚

### æ­¥éª¤1ï¼šå‡†å¤‡Cloudflareè´¦å·

1. **æ³¨å†ŒCloudflareè´¦å·**
   - è®¿é—®ï¼šhttps://www.cloudflare.com
   - æ³¨å†Œè´¦å·ï¼ˆå…è´¹ï¼‰

2. **æ·»åŠ åŸŸååˆ°Cloudflare**
   - ç™»å½•åï¼Œç‚¹å‡»"æ·»åŠ ç«™ç‚¹"
   - è¾“å…¥ä½ çš„é˜¿é‡Œäº‘åŸŸåï¼ˆå¦‚ï¼šmycloud.comï¼‰
   - é€‰æ‹©å…è´¹è®¡åˆ’

3. **ä¿®æ”¹DNSæœåŠ¡å™¨**
   - Cloudflareä¼šæä¾›DNSæœåŠ¡å™¨åœ°å€ï¼ˆå¦‚ï¼š`xxx.ns.cloudflare.com`ï¼‰
   - åœ¨é˜¿é‡Œäº‘åŸŸåæ§åˆ¶å°ä¿®æ”¹DNSæœåŠ¡å™¨ï¼š
     - ç™»å½•é˜¿é‡Œäº‘ â†’ åŸŸåæ§åˆ¶å°
     - æ‰¾åˆ°ä½ çš„åŸŸå â†’ ç‚¹å‡»"ç®¡ç†"
     - ä¿®æ”¹DNSæœåŠ¡å™¨ä¸ºCloudflareæä¾›çš„åœ°å€
   - ç­‰å¾…ç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰

### æ­¥éª¤2ï¼šåœ¨æ ‘è“æ´¾ä¸Šé…ç½®Cloudflare Tunnel

#### 2.1 å®‰è£… cloudflared

åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œï¼š

```bash
# ä¸‹è½½ cloudflaredï¼ˆARM64ç‰ˆæœ¬ï¼Œé€‚ç”¨äºæ ‘è“æ´¾ï¼‰
cd /tmp
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-arm64

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x cloudflared-linux-arm64

# ç§»åŠ¨åˆ°ç³»ç»Ÿè·¯å¾„
sudo mv cloudflared-linux-arm64 /usr/local/bin/cloudflared

# éªŒè¯å®‰è£…
cloudflared --version
```

#### 2.2 ç™»å½• Cloudflare

```bash
# æ‰§è¡Œç™»å½•å‘½ä»¤ï¼Œä¼šæ‰“å¼€æµè§ˆå™¨
cloudflared tunnel login
```

**æ“ä½œæ­¥éª¤ï¼š**
1. å‘½ä»¤æ‰§è¡Œåä¼šæ˜¾ç¤ºä¸€ä¸ªURL
2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¯¥URLï¼ˆå¦‚æœæ ‘è“æ´¾æœ‰å›¾å½¢ç•Œé¢ï¼Œä¼šè‡ªåŠ¨æ‰“å¼€ï¼‰
3. å¦‚æœæ²¡æœ‰å›¾å½¢ç•Œé¢ï¼Œåœ¨ç¬”è®°æœ¬æµè§ˆå™¨ä¸­æ‰‹åŠ¨æ‰“å¼€URL
4. ç™»å½•ä½ çš„Cloudflareè´¦å·
5. é€‰æ‹©è¦ä½¿ç”¨çš„åŸŸå
6. ç‚¹å‡»"æˆæƒ"
7. æˆæƒæˆåŠŸåï¼Œè¯ä¹¦æ–‡ä»¶ä¼šä¿å­˜åœ¨ `/root/.cloudflared/` ç›®å½•

#### 2.3 åˆ›å»ºéš§é“

```bash
# åˆ›å»ºåä¸º raspberrycloud çš„éš§é“
cloudflared tunnel create raspberrycloud
```

**è¯´æ˜ï¼š**
- éš§é“åç§°å¯ä»¥è‡ªå®šä¹‰ï¼Œè¿™é‡Œä½¿ç”¨ `raspberrycloud`
- åˆ›å»ºæˆåŠŸåä¼šæ˜¾ç¤ºéš§é“IDï¼ˆUUIDï¼‰ï¼Œè¯·è®°å½•ä¸‹æ¥

#### 2.4 æŸ¥çœ‹éš§é“ä¿¡æ¯

```bash
# æŸ¥çœ‹æ‰€æœ‰éš§é“
cloudflared tunnel list

# è®°å½•ä¸‹ raspberrycloud å¯¹åº”çš„éš§é“IDï¼ˆUUIDï¼‰
# ä¾‹å¦‚ï¼ša1b2c3d4-e5f6-7890-abcd-ef1234567890
```

#### 2.5 é…ç½®DNSè·¯ç”±

å°†åŸŸåæŒ‡å‘éš§é“ï¼š

```bash
# é…ç½®ä¸»åŸŸåè·¯ç”±ï¼ˆæ›¿æ¢ä¸ºä½ çš„åŸŸåï¼‰
cloudflared tunnel route dns raspberrycloud ä½ çš„åŸŸå.com

# é…ç½®wwwå­åŸŸåè·¯ç”±
cloudflared tunnel route dns raspberrycloud www.ä½ çš„åŸŸå.com
```

**è¯´æ˜ï¼š**
- è¿™ä¼šè‡ªåŠ¨åœ¨Cloudflareä¸­åˆ›å»ºCNAMEè®°å½•
- å°† `ä½ çš„åŸŸå.com` å’Œ `www.ä½ çš„åŸŸå.com` æŒ‡å‘éš§é“

#### 2.6 åˆ›å»ºé…ç½®æ–‡ä»¶

é¦–å…ˆè·å–éš§é“UUIDï¼š

```bash
# æŸ¥çœ‹éš§é“åˆ—è¡¨ï¼Œæ‰¾åˆ° raspberrycloud çš„UUID
cloudflared tunnel list
# è¾“å‡ºç¤ºä¾‹ï¼š
# ID                                   NAME             CREATED
# a1b2c3d4-e5f6-7890-abcd-ef1234567890 raspberrycloud   2024-01-01T12:00:00Z
```

åˆ›å»ºé…ç½®ç›®å½•å’Œæ–‡ä»¶ï¼š

```bash
# åˆ›å»ºé…ç½®ç›®å½•
sudo mkdir -p /etc/cloudflared

# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo nano /etc/cloudflared/config.yml
```

åœ¨é…ç½®æ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼ˆ**æ›¿æ¢ä¸ºä½ çš„å®é™…å€¼**ï¼‰ï¼š

```yaml
tunnel: a1b2c3d4-e5f6-7890-abcd-ef1234567890  # æ›¿æ¢ä¸ºä½ çš„éš§é“UUID
credentials-file: /root/.cloudflared/a1b2c3d4-e5f6-7890-abcd-ef1234567890.json  # æ›¿æ¢ä¸ºä½ çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„

ingress:
  - hostname: ä½ çš„åŸŸå.com  # æ›¿æ¢ä¸ºä½ çš„åŸŸå
    service: http://localhost:80
  - hostname: www.ä½ çš„åŸŸå.com  # æ›¿æ¢ä¸ºä½ çš„åŸŸå
    service: http://localhost:80
  - service: http_status:404
```

**é‡è¦è¯´æ˜ï¼š**
- `tunnel`: æ›¿æ¢ä¸ºæ­¥éª¤2.4ä¸­è·å–çš„éš§é“UUID
- `credentials-file`: è¯ä¹¦æ–‡ä»¶è·¯å¾„é€šå¸¸æ˜¯ `/root/.cloudflared/éš§é“UUID.json`
- `hostname`: æ›¿æ¢ä¸ºä½ çš„å®é™…åŸŸåï¼ˆå¦‚ï¼š`mycloud.com`ï¼‰

ä¿å­˜æ–‡ä»¶ï¼ˆCtrl+Oï¼Œå›è½¦ï¼ŒCtrl+Xï¼‰

#### 2.7 åˆ›å»ºç³»ç»ŸæœåŠ¡

åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶ï¼Œè®©éš§é“å¼€æœºè‡ªå¯ï¼š

```bash
sudo nano /etc/systemd/system/cloudflared.service
```

è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Cloudflare Tunnel
After=network.target

[Service]
Type=simple
User=root
ExecStart=/usr/local/bin/cloudflared tunnel --config /etc/cloudflared/config.yml run
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

ä¿å­˜æ–‡ä»¶ã€‚

#### 2.8 å¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable cloudflared

# å¯åŠ¨æœåŠ¡
sudo systemctl start cloudflared

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status cloudflared
```

**éªŒè¯æœåŠ¡è¿è¡Œï¼š**
- å¦‚æœçœ‹åˆ° `active (running)` è¡¨ç¤ºæœåŠ¡æ­£å¸¸è¿è¡Œ
- å¦‚æœçœ‹åˆ°é”™è¯¯ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š`sudo journalctl -u cloudflared -n 50`

#### 2.9 æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u cloudflared -f

# æŸ¥çœ‹æœ€è¿‘50æ¡æ—¥å¿—
sudo journalctl -u cloudflared -n 50
```

### æ­¥éª¤3ï¼šé…ç½®æ ‘è“æ´¾Nginx

åœ¨æ ‘è“æ´¾ä¸Šæ‰§è¡Œï¼š

```bash
# ç¼–è¾‘Nginxé…ç½®
sudo nano /etc/nginx/sites-available/raspberrycloud
```

**æ‰¾åˆ°ä»¥ä¸‹è¡Œï¼š**
```nginx
server_name _;  # æ›¿æ¢ä¸ºä½ çš„åŸŸåï¼Œå¦‚: cloud.example.com
```

**ä¿®æ”¹ä¸ºï¼š**
```nginx
server_name ä½ çš„åŸŸå.com www.ä½ çš„åŸŸå.com;
```

**å®Œæ•´ç¤ºä¾‹ï¼ˆå‡è®¾åŸŸåä¸º mycloud.comï¼‰ï¼š**
```nginx
server_name mycloud.com www.mycloud.com;
```

**ä¿å­˜æ–‡ä»¶ï¼š**
- æŒ‰ `Ctrl+O` ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤
- æŒ‰ `Ctrl+X` é€€å‡º

**æµ‹è¯•å¹¶é‡è½½ï¼š**

```bash
# æµ‹è¯•Nginxé…ç½®è¯­æ³•
sudo nginx -t

# å¦‚æœæ˜¾ç¤º "syntax is ok" å’Œ "test is successful"ï¼Œç»§ç»­ä¸‹ä¸€æ­¥
# å¦‚æœæœ‰é”™è¯¯ï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„åŸŸåæ˜¯å¦æ­£ç¡®

# é‡è½½Nginxé…ç½®
sudo systemctl reload nginx
```

### æ­¥éª¤4ï¼šéªŒè¯è®¿é—®

1. **ç­‰å¾…DNSç”Ÿæ•ˆ**ï¼ˆ5-30åˆ†é’Ÿï¼‰

2. **ä»ä»»ä½•åœ°æ–¹è®¿é—®**
   - æµè§ˆå™¨è®¿é—®ï¼š`https://ä½ çš„åŸŸå.com`
   - æ£€æŸ¥åœ°å€æ æ˜¯å¦æœ‰é”å›¾æ ‡ ğŸ”’
   - Cloudflare Tunnel è‡ªåŠ¨æä¾›HTTPSï¼Œæ— éœ€é…ç½®SSLè¯ä¹¦

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

### æ–¹æ¡ˆä¸€ï¼ˆæœ‰å…¬ç½‘IPï¼‰

- [ ] ç¬”è®°æœ¬ç«¯å£è½¬å‘å·²é…ç½®ï¼ˆWindowsæˆ–è·¯ç”±å™¨ï¼‰
- [ ] ç¬”è®°æœ¬é˜²ç«å¢™å·²å¼€æ”¾80/443ç«¯å£
- [ ] é˜¿é‡Œäº‘åŸŸåè§£æå·²é…ç½®ï¼ˆAè®°å½•ï¼‰
- [ ] DNSè§£æå·²ç”Ÿæ•ˆï¼ˆnslookupéªŒè¯ï¼‰
- [ ] æ ‘è“æ´¾Nginxé…ç½®å·²æ›´æ–°ï¼ˆserver_nameï¼‰
- [ ] SSLè¯ä¹¦å·²ç”³è¯·
- [ ] æ ‘è“æ´¾é˜²ç«å¢™å·²å¼€æ”¾ç«¯å£
- [ ] å¤–ç½‘è®¿é—®æµ‹è¯•æˆåŠŸï¼ˆæ‰‹æœº4Gï¼‰

### æ–¹æ¡ˆäºŒï¼ˆæ— å…¬ç½‘IPï¼‰

- [ ] Cloudflareè´¦å·å·²æ³¨å†Œ
- [ ] åŸŸåå·²æ·»åŠ åˆ°Cloudflare
- [ ] DNSæœåŠ¡å™¨å·²ä¿®æ”¹ä¸ºCloudflare
- [ ] Cloudflare Tunnelå·²é…ç½®
- [ ] éš§é“æœåŠ¡å·²å¯åŠ¨
- [ ] æ ‘è“æ´¾Nginxé…ç½®å·²æ›´æ–°
- [ ] å¤–ç½‘è®¿é—®æµ‹è¯•æˆåŠŸ

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ— æ³•ä»å¤–ç½‘è®¿é—®

**æ£€æŸ¥æ¸…å•ï¼š**
1. âœ… ç«¯å£è½¬å‘æ˜¯å¦æ­£ç¡®é…ç½®
2. âœ… é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç«¯å£
3. âœ… æ ‘è“æ´¾æœåŠ¡æ˜¯å¦è¿è¡Œ
4. âœ… DNSè§£ææ˜¯å¦ç”Ÿæ•ˆ
5. âœ… æ˜¯å¦ä½¿ç”¨æ‰‹æœº4Gæµ‹è¯•ï¼ˆæ’é™¤æœ¬åœ°ç½‘ç»œç¼“å­˜ï¼‰

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
# åœ¨æ ‘è“æ´¾ä¸Šæµ‹è¯•æœ¬åœ°æœåŠ¡
curl http://localhost:8000/api/health

# ä»å¤–ç½‘æµ‹è¯•ï¼ˆä½¿ç”¨æ‰‹æœº4Gæˆ–åœ¨çº¿å·¥å…·ï¼‰
curl http://ä½ çš„åŸŸå.com/api/health
```

### Q2: SSLè¯ä¹¦ç”³è¯·å¤±è´¥

**é”™è¯¯ï¼š** `Failed to verify domain ownership`

**å¯èƒ½åŸå› ï¼š**
- åŸŸåæœªæ­£ç¡®è§£æåˆ°å…¬ç½‘IP
- 80ç«¯å£æœªå¼€æ”¾æˆ–æœªæ˜ å°„
- é˜²ç«å¢™é˜»æ­¢

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. éªŒè¯åŸŸåè§£æ
nslookup ä½ çš„åŸŸå.com

# 2. æ£€æŸ¥80ç«¯å£æ˜¯å¦å¯è®¿é—®
curl http://ä½ çš„åŸŸå.com

# 3. å¦‚æœä½¿ç”¨éæ ‡å‡†ç«¯å£ï¼Œä¸´æ—¶æ˜ å°„80ç«¯å£ç”³è¯·è¯ä¹¦
```

### Q3: Cloudflare Tunnelè¿æ¥å¤±è´¥

**æ£€æŸ¥ï¼š**
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status cloudflared

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u cloudflared -f

# æµ‹è¯•è¿æ¥
cloudflared tunnel info
```

### Q4: Windowsç«¯å£è½¬å‘ä¸ç”Ÿæ•ˆ

**å¯èƒ½åŸå› ï¼š**
- æœªä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
- é˜²ç«å¢™æœªå¼€æ”¾ç«¯å£
- IP HelperæœåŠ¡æœªå¯åŠ¨

**è§£å†³æ–¹æ¡ˆï¼š**
```powershell
# 1. ç¡®ä¿ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell

# 2. å¯åŠ¨IP HelperæœåŠ¡
Start-Service iphlpsvc
Set-Service -Name iphlpsvc -StartupType Automatic

# 3. æ£€æŸ¥ç«¯å£è½¬å‘è§„åˆ™
netsh interface portproxy show all

# 4. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
Get-NetFirewallRule | Where-Object {$_.DisplayName -like "*RaspberryCloud*"}
```

### Q5: ç¬”è®°æœ¬IPå˜åŒ–ï¼ˆåŠ¨æ€IPï¼‰

**è§£å†³æ–¹æ¡ˆï¼šé…ç½®DDNSè‡ªåŠ¨æ›´æ–°**

å¦‚æœç¬”è®°æœ¬çš„å…¬ç½‘IPä¼šå˜åŒ–ï¼Œéœ€è¦é…ç½®DDNSï¼š

1. **ä½¿ç”¨é˜¿é‡Œäº‘DNS APIè‡ªåŠ¨æ›´æ–°**
   - éœ€è¦è·å–AccessKeyå’ŒSecretKey
   - ç¼–å†™è„šæœ¬å®šæœŸæ›´æ–°Aè®°å½•

2. **ä½¿ç”¨Cloudflare Tunnelï¼ˆæ¨èï¼‰**
   - æ–¹æ¡ˆäºŒä¸éœ€è¦å…¬ç½‘IPï¼ŒIPå˜åŒ–ä¸å½±å“

---

## ğŸ“± è®¿é—®æ–¹å¼

é…ç½®å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®ï¼š

### æ–¹æ¡ˆä¸€ï¼ˆæœ‰å…¬ç½‘IPï¼‰
- **HTTPSï¼ˆæ¨èï¼‰**: `https://ä½ çš„åŸŸå.com`
- **HTTPï¼ˆè‡ªåŠ¨è·³è½¬ï¼‰**: `http://ä½ çš„åŸŸå.com` â†’ è‡ªåŠ¨è·³è½¬åˆ°HTTPS
- **å¸¦www**: `https://www.ä½ çš„åŸŸå.com`

### æ–¹æ¡ˆäºŒï¼ˆå†…ç½‘ç©¿é€ï¼‰
- **HTTPS**: `https://ä½ çš„åŸŸå.com`ï¼ˆCloudflareè‡ªåŠ¨æä¾›HTTPSï¼‰
- **å¸¦www**: `https://www.ä½ çš„åŸŸå.com`

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å¯ä»¥é€šè¿‡åŸŸåä»ä»»ä½•åœ°æ–¹è®¿é—®ä½ çš„ç§æœ‰äº‘å­˜å‚¨äº†ï¼

**å®‰å…¨æç¤ºï¼š**
- âœ… ç«‹å³ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
- âœ… å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶
- âœ… å®šæœŸæ£€æŸ¥è®¿é—®æ—¥å¿—
- âœ… å¤‡ä»½é‡è¦æ•°æ®
- âœ… å¦‚æœä½¿ç”¨æ–¹æ¡ˆä¸€ï¼Œè€ƒè™‘é…ç½®Fail2bané˜²æš´åŠ›ç ´è§£

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ï¼š`docs/` ç›®å½•
2. æ£€æŸ¥æ—¥å¿—ï¼š`sudo journalctl -u raspberrycloud -f`
3. æŸ¥çœ‹Nginxæ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/raspberrycloud_error.log`

