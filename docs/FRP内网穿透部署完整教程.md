# FRPå†…ç½‘ç©¿é€éƒ¨ç½²å®Œæ•´æ•™ç¨‹

æœ¬æ•™ç¨‹å°†å¸®åŠ©æ‚¨é€šè¿‡FRPå†…ç½‘ç©¿é€ï¼Œè®©æ‚¨çš„æ ‘è“æ´¾ç§æœ‰äº‘å¯ä»¥ä»å¤–ç½‘è®¿é—®ï¼Œä½¿ç”¨æ‚¨çš„åŸŸå `piowncloud.com`ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶æ£€æŸ¥

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®è®¤ï¼š

- âœ… æ ‘è“æ´¾å·²å®ŒæˆåŸºç¡€éƒ¨ç½²ï¼ˆå‚è€ƒ `02-ç³»ç»Ÿéƒ¨ç½²æ•™ç¨‹.md`ï¼‰
- âœ… æ ‘è“æ´¾å¯ä»¥æ­£å¸¸è®¿é—®äº’è”ç½‘
- âœ… å·²æœ‰é˜¿é‡Œäº‘åŸŸåï¼š`piowncloud.com`
- âœ… å·²æœ‰é˜¿é‡Œäº‘è´¦å·ï¼ˆæˆ–å‡†å¤‡æ³¨å†Œï¼‰
- âœ… å‡†å¤‡è´­ä¹°é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ˆ38-108å…ƒ/å¹´ï¼‰

## ğŸ¯ æ•´ä½“æµç¨‹æ¦‚è§ˆ

```
ç¬¬1æ­¥ï¼šè´­ä¹°å¹¶é…ç½®é˜¿é‡Œäº‘æœåŠ¡å™¨     [é¢„è®¡15åˆ†é’Ÿ]
ç¬¬2æ­¥ï¼šæœåŠ¡å™¨ç«¯å®‰è£…FRPæœåŠ¡ç«¯      [é¢„è®¡10åˆ†é’Ÿ]
ç¬¬3æ­¥ï¼šæ ‘è“æ´¾å®‰è£…FRPå®¢æˆ·ç«¯        [é¢„è®¡10åˆ†é’Ÿ]
ç¬¬4æ­¥ï¼šé…ç½®é˜¿é‡Œäº‘åŸŸåè§£æ         [é¢„è®¡5åˆ†é’Ÿ]
ç¬¬5æ­¥ï¼šé…ç½®HTTPSè¯ä¹¦              [é¢„è®¡10åˆ†é’Ÿ]
ç¬¬6æ­¥ï¼šæµ‹è¯•å’ŒéªŒè¯                 [é¢„è®¡5åˆ†é’Ÿ]

æ€»è®¡çº¦ï¼š55åˆ†é’Ÿ
```

---

## ğŸ“¦ ç¬¬1æ­¥ï¼šè´­ä¹°é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ˆ15åˆ†é’Ÿï¼‰

### 1.1 è®¿é—®é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨

1. è®¿é—®é˜¿é‡Œäº‘å®˜ç½‘ï¼šhttps://www.aliyun.com
2. ç™»å½•æ‚¨çš„é˜¿é‡Œäº‘è´¦å·ï¼ˆæ²¡æœ‰å°±æ³¨å†Œä¸€ä¸ªï¼‰
3. æœç´¢"è½»é‡åº”ç”¨æœåŠ¡å™¨"æˆ–ç›´æ¥è®¿é—®ï¼š
   https://www.aliyun.com/product/swas

### 1.2 é€‰æ‹©é…ç½®

æ¨èé…ç½®ï¼ˆå®¶åº­ä½¿ç”¨å®Œå…¨å¤Ÿç”¨ï¼‰ï¼š

```
åœ°åŸŸï¼šé€‰æ‹©ç¦»æ‚¨æœ€è¿‘çš„
  - åä¸œï¼ˆå¦‚æœåœ¨æ±Ÿæµ™æ²ªï¼‰
  - åå—ï¼ˆå¦‚æœåœ¨å¹¿ä¸œç¦å»ºï¼‰
  - ååŒ—ï¼ˆå¦‚æœåœ¨åŒ—äº¬å‘¨è¾¹ï¼‰

é•œåƒï¼šUbuntu 22.04 LTS

å¥—é¤ï¼š
  æ–°ç”¨æˆ·æ¨èï¼š1æ ¸2G 3Mbps 40GBå­˜å‚¨
    - ä»·æ ¼ï¼šé¦–å¹´ ~38å…ƒ
    - æµé‡ï¼šæ¯æœˆ60GB
  
  æˆ–è€…ï¼š2æ ¸2G 4Mbps 60GBå­˜å‚¨
    - ä»·æ ¼ï¼šé¦–å¹´ ~66å…ƒ
    - æµé‡ï¼šæ¯æœˆ200GB
```

### 1.3 å®Œæˆè´­ä¹°

1. é€‰æ‹©å¥—é¤åç‚¹å‡»"ç«‹å³è´­ä¹°"
2. è´­ä¹°æ—¶é•¿é€‰æ‹©"1å¹´"ï¼ˆæ€§ä»·æ¯”æœ€é«˜ï¼‰
3. è®¾ç½®æœåŠ¡å™¨å¯†ç ï¼ˆè®°ä½è¿™ä¸ªå¯†ç ï¼ï¼‰
4. å‹¾é€‰åè®®ï¼Œå®Œæˆæ”¯ä»˜

### 1.4 è®°å½•æœåŠ¡å™¨ä¿¡æ¯

è´­ä¹°å®Œæˆåï¼Œè¿›å…¥æ§åˆ¶å°ï¼š

```
è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼ˆå¾ˆé‡è¦ï¼ï¼‰ï¼š
1. å…¬ç½‘IPï¼šå¦‚ 47.100.123.45
2. æœåŠ¡å™¨å¯†ç ï¼šæ‚¨åˆšæ‰è®¾ç½®çš„å¯†ç 
3. ç”¨æˆ·åï¼šrootï¼ˆé»˜è®¤ï¼‰
```

### 1.5 é…ç½®é˜²ç«å¢™

åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°ï¼š

1. è¿›å…¥æ‚¨çš„è½»é‡æœåŠ¡å™¨è¯¦æƒ…é¡µ
2. ç‚¹å‡»"é˜²ç«å¢™"
3. æ·»åŠ ä»¥ä¸‹è§„åˆ™ï¼š

```
è§„åˆ™1ï¼š
  åè®®ï¼šTCP
  ç«¯å£ï¼š80
  è¯´æ˜ï¼šHTTP

è§„åˆ™2ï¼š
  åè®®ï¼šTCP
  ç«¯å£ï¼š443
  è¯´æ˜ï¼šHTTPS

è§„åˆ™3ï¼š
  åè®®ï¼šTCP
  ç«¯å£ï¼š7000
  è¯´æ˜ï¼šFRPé€šä¿¡ç«¯å£

è§„åˆ™4ï¼š
  åè®®ï¼šTCP
  ç«¯å£ï¼š7500
  è¯´æ˜ï¼šFRPæ§åˆ¶å°ï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ–¥ï¸ ç¬¬2æ­¥ï¼šé…ç½®é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼ˆ10åˆ†é’Ÿï¼‰

### 2.1 SSHè¿æ¥åˆ°æœåŠ¡å™¨

**Windowsç”¨æˆ·ï¼š**

ä½¿ç”¨PowerShellæˆ–ä¸‹è½½PuTTYï¼š

```powershell
# æ‰“å¼€PowerShellï¼Œè¾“å…¥ï¼š
ssh root@ä½ çš„æœåŠ¡å™¨IP

# ä¾‹å¦‚ï¼š
ssh root@47.100.123.45

# è¾“å…¥yesï¼ˆé¦–æ¬¡è¿æ¥ï¼‰
# è¾“å…¥å¯†ç ï¼ˆä¸æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„ï¼‰
```

**Mac/Linuxç”¨æˆ·ï¼š**

```bash
# æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š
ssh root@ä½ çš„æœåŠ¡å™¨IP

# è¾“å…¥å¯†ç 
```

### 2.2 æ›´æ–°ç³»ç»Ÿ

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update

# å‡çº§ç³»ç»Ÿï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰
apt upgrade -y
```

### 2.3 ä¸‹è½½å¹¶è¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨æˆ‘æä¾›çš„è‡ªåŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
# ä¸‹è½½å®‰è£…è„šæœ¬
wget https://raw.githubusercontent.com/yourusername/RaspiOwnCloud/main/scripts/install_frps.sh

# å¦‚æœGitHubè®¿é—®å›°éš¾ï¼Œä½¿ç”¨å›½å†…é•œåƒï¼š
wget https://gitee.com/yourusername/RaspiOwnCloud/raw/main/scripts/install_frps.sh

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x install_frps.sh

# è¿è¡Œå®‰è£…è„šæœ¬
bash install_frps.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… ä¸‹è½½FRPæœåŠ¡ç«¯
- âœ… åˆ›å»ºé…ç½®æ–‡ä»¶
- âœ… è®¾ç½®systemdæœåŠ¡
- âœ… å¯åŠ¨FRPæœåŠ¡

**æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…ï¼ˆå¦‚æœè„šæœ¬ä¸å¯ç”¨ï¼‰**

è¯·å‚è€ƒæœ¬æ–‡æ¡£æœ«å°¾çš„"é™„å½•Aï¼šæ‰‹åŠ¨å®‰è£…FRPæœåŠ¡ç«¯"

### 2.4 è®°å½•FRP Token

å®‰è£…å®Œæˆåï¼Œè„šæœ¬ä¼šç”Ÿæˆä¸€ä¸ªéšæœºtokenï¼Œè¯·è®°å½•ä¸‹æ¥ï¼š

```
=== FRPæœåŠ¡ç«¯å®‰è£…å®Œæˆ ===
FRP Token: abc123def456ghi789
è¯·å°†æ­¤Tokenè®°å½•ä¸‹æ¥ï¼Œé…ç½®å®¢æˆ·ç«¯æ—¶éœ€è¦ä½¿ç”¨ï¼
```

**é‡è¦ï¼šè¿™ä¸ªTokenè¦åœ¨æ ‘è“æ´¾é…ç½®æ—¶ä½¿ç”¨ï¼**

### 2.5 éªŒè¯æœåŠ¡è¿è¡Œ

```bash
# æŸ¥çœ‹FRPæœåŠ¡çŠ¶æ€
systemctl status frps

# åº”è¯¥æ˜¾ç¤º active (running)

# æŸ¥çœ‹FRPæ—¥å¿—
tail -f /var/log/frps.log
```

---

## ğŸ“ ç¬¬3æ­¥ï¼šé…ç½®æ ‘è“æ´¾ï¼ˆ10åˆ†é’Ÿï¼‰

### 3.1 SSHè¿æ¥åˆ°æ ‘è“æ´¾

ä»æ‚¨çš„ç¬”è®°æœ¬è¿æ¥æ ‘è“æ´¾ï¼š

```bash
# Windows PowerShell æˆ– Mac/Linux ç»ˆç«¯
ssh pi@æ ‘è“æ´¾IP

# ä¾‹å¦‚ï¼š
ssh pi@192.168.137.100
```

### 3.2 ä¸‹è½½å¹¶è¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ~/Desktop/Github/RaspiOwnCloud

# å¦‚æœæ²¡æœ‰è¿™ä¸ªç›®å½•ï¼Œå…ˆå…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/RaspiOwnCloud.git
cd RaspiOwnCloud

# è¿è¡Œæ ‘è“æ´¾ç«¯å®‰è£…è„šæœ¬
bash scripts/install_frpc.sh

# æŒ‰æç¤ºè¾“å…¥ï¼š
# 1. é˜¿é‡Œäº‘æœåŠ¡å™¨IP
# 2. FRP Tokenï¼ˆä¸Šä¸€æ­¥è®°å½•çš„ï¼‰
# 3. æ‚¨çš„åŸŸåï¼ˆpiowncloud.comï¼‰
```

### 3.3 éªŒè¯FRPå®¢æˆ·ç«¯è¿è¡Œ

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status frpc

# åº”è¯¥æ˜¾ç¤º active (running)

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u frpc -f

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
# [INFO] login to server success
# [INFO] start proxy success
```

å¦‚æœçœ‹åˆ° "login to server success"ï¼Œè¯´æ˜éš§é“å»ºç«‹æˆåŠŸï¼ğŸ‰

---

## ğŸŒ ç¬¬4æ­¥ï¼šé…ç½®åŸŸåè§£æï¼ˆ5åˆ†é’Ÿï¼‰

### 4.1 ç™»å½•é˜¿é‡Œäº‘DNSæ§åˆ¶å°

1. è®¿é—®ï¼šhttps://dns.console.aliyun.com/
2. æ‰¾åˆ°æ‚¨çš„åŸŸåï¼š`piowncloud.com`
3. ç‚¹å‡»"è§£æè®¾ç½®"

### 4.2 æ·»åŠ Aè®°å½•

ç‚¹å‡»"æ·»åŠ è®°å½•"ï¼Œå¡«å†™ï¼š

```
è®°å½•ç±»å‹ï¼šA
ä¸»æœºè®°å½•ï¼š@
è§£æçº¿è·¯ï¼šé»˜è®¤
è®°å½•å€¼ï¼šæ‚¨çš„é˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘IPï¼ˆå¦‚ 47.100.123.45ï¼‰
TTLï¼š600ï¼ˆ10åˆ†é’Ÿï¼‰
```

ç‚¹å‡»"ç¡®è®¤"ã€‚

### 4.3 æ·»åŠ wwwå­åŸŸåï¼ˆå¯é€‰ï¼‰

å†æ·»åŠ ä¸€æ¡è®°å½•ï¼š

```
è®°å½•ç±»å‹ï¼šA
ä¸»æœºè®°å½•ï¼šwww
è§£æçº¿è·¯ï¼šé»˜è®¤
è®°å½•å€¼ï¼šæ‚¨çš„é˜¿é‡Œäº‘æœåŠ¡å™¨å…¬ç½‘IP
TTLï¼š600
```

### 4.4 éªŒè¯DNSè§£æ

```bash
# åœ¨æ‚¨çš„ç”µè„‘æˆ–æ ‘è“æ´¾ä¸Šæ‰§è¡Œ
nslookup piowncloud.com

# åº”è¯¥è¿”å›æ‚¨çš„é˜¿é‡Œäº‘æœåŠ¡å™¨IP
# æ³¨æ„ï¼šDNSè§£æå¯èƒ½éœ€è¦5-10åˆ†é’Ÿç”Ÿæ•ˆ
```

---

## ğŸ”’ ç¬¬5æ­¥ï¼šé…ç½®HTTPSè¯ä¹¦ï¼ˆ10åˆ†é’Ÿï¼‰

### 5.1 åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šå®‰è£…Certbot

```bash
# SSHè¿æ¥åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# å®‰è£…Certbot
apt install -y certbot
```

### 5.2 ç”³è¯·SSLè¯ä¹¦

```bash
# ä½¿ç”¨Certbotç”³è¯·è¯ä¹¦
certbot certonly --standalone -d piowncloud.com -d www.piowncloud.com

# æŒ‰æç¤ºæ“ä½œï¼š
# 1. è¾“å…¥é‚®ç®±ï¼ˆç”¨äºæ¥æ”¶è¯ä¹¦è¿‡æœŸæé†’ï¼‰
# 2. åŒæ„æœåŠ¡æ¡æ¬¾ï¼šè¾“å…¥ Y
# 3. æ˜¯å¦æ¥æ”¶é‚®ä»¶ï¼šè¾“å…¥ Nï¼ˆå¯é€‰ï¼‰
```

**æ³¨æ„ï¼š**
- ç”³è¯·æ—¶éœ€è¦æš‚åœFRPæœåŠ¡ï¼š`systemctl stop frps`
- ç”³è¯·å®Œæˆåé‡å¯ï¼š`systemctl start frps`

æˆ–è€…ä½¿ç”¨è‡ªåŠ¨é…ç½®è„šæœ¬ï¼š

```bash
# è¿è¡ŒHTTPSé…ç½®è„šæœ¬
bash /root/setup_https.sh piowncloud.com www.piowncloud.com
```

### 5.3 é…ç½®è¯ä¹¦è‡ªåŠ¨ç»­æœŸ

```bash
# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run

# æ·»åŠ å®šæ—¶ä»»åŠ¡
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯æœˆ1æ—¥å‡Œæ™¨3ç‚¹æ£€æŸ¥ç»­æœŸï¼‰
0 3 1 * * certbot renew --quiet --pre-hook "systemctl stop frps" --post-hook "systemctl start frps"
```

### 5.4 ä¿®æ”¹FRPé…ç½®æ”¯æŒHTTPS

```bash
# ç¼–è¾‘FRPæœåŠ¡ç«¯é…ç½®
nano /etc/frp/frps.ini

# åœ¨ [common] éƒ¨åˆ†æ·»åŠ ï¼š
vhost_https_port = 443

# é‡å¯FRP
systemctl restart frps
```

### 5.5 ä¿®æ”¹æ ‘è“æ´¾FRPå®¢æˆ·ç«¯é…ç½®

åœ¨æ ‘è“æ´¾ä¸Šï¼š

```bash
# ç¼–è¾‘FRPå®¢æˆ·ç«¯é…ç½®
sudo nano /etc/frp/frpc.ini

# æ·»åŠ HTTPSä»£ç†é…ç½®ï¼ˆåœ¨æ–‡ä»¶æœ«å°¾ï¼‰
[raspberrycloud-https]
type = https
local_ip = 127.0.0.1
local_port = 443
custom_domains = piowncloud.com

# é‡å¯FRPå®¢æˆ·ç«¯
sudo systemctl restart frpc
```

---

## âœ… ç¬¬6æ­¥ï¼šæµ‹è¯•éªŒè¯ï¼ˆ5åˆ†é’Ÿï¼‰

### 6.1 æµ‹è¯•HTTPè®¿é—®

åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š

```
http://piowncloud.com
```

åº”è¯¥èƒ½çœ‹åˆ°æ‚¨çš„RaspberryCloudç™»å½•é¡µé¢ï¼

### 6.2 æµ‹è¯•HTTPSè®¿é—®

åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š

```
https://piowncloud.com
```

åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- âœ… æ˜¾ç¤ºç™»å½•é¡µé¢
- âœ… åœ°å€æ æœ‰é”å›¾æ ‡ï¼ˆå®‰å…¨è¿æ¥ï¼‰
- âœ… æ²¡æœ‰è¯ä¹¦è­¦å‘Š

### 6.3 æµ‹è¯•å¤–ç½‘è®¿é—®

1. ç”¨æ‰‹æœºå…³é—­WiFiï¼Œä½¿ç”¨4G/5Gç½‘ç»œ
2. æµè§ˆå™¨è®¿é—®ï¼š`https://piowncloud.com`
3. å°è¯•ç™»å½•å¹¶ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶

### 6.4 æµ‹è¯•ä¸åŒç½‘ç»œç¯å¢ƒ

**é‡è¦æµ‹è¯•ï¼šéªŒè¯ç½‘ç»œçµæ´»æ€§**

1. è®°å½•æ ‘è“æ´¾å½“å‰ç½‘ç»œç¯å¢ƒ
2. å°†æ ‘è“æ´¾è¿æ¥åˆ°å¦ä¸€ä¸ªWiFiï¼ˆå¦‚æ‰‹æœºçƒ­ç‚¹ï¼‰
3. ç­‰å¾…30ç§’ï¼ŒFRPä¼šè‡ªåŠ¨é‡è¿
4. å†æ¬¡è®¿é—® `https://piowncloud.com`
5. åº”è¯¥ä»ç„¶æ­£å¸¸è®¿é—®ï¼âœ…

**è¿™è¯æ˜ï¼š**
- âœ… æ ‘è“æ´¾å¯ä»¥éšæ„æ›´æ¢ç½‘ç»œ
- âœ… å¤–ç½‘è®¿é—®ä¸å—å½±å“
- âœ… åŸŸåå§‹ç»ˆæœ‰æ•ˆ

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹FRPçŠ¶æ€

**åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼š**

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status frps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f /var/log/frps.log

# æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
curl http://localhost:7500/api/proxy/tcp  # å¦‚æœå¼€å¯äº†æ§åˆ¶å°
```

**åœ¨æ ‘è“æ´¾ï¼š**

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status frpc

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u frpc -f

# é‡å¯FRPå®¢æˆ·ç«¯
sudo systemctl restart frpc
```

### å¸¸ç”¨ç®¡ç†å‘½ä»¤

```bash
# é‡å¯æœåŠ¡
sudo systemctl restart frpc    # æ ‘è“æ´¾
systemctl restart frps         # é˜¿é‡Œäº‘æœåŠ¡å™¨

# åœæ­¢æœåŠ¡
sudo systemctl stop frpc
systemctl stop frps

# æŸ¥çœ‹é…ç½®
cat /etc/frp/frpc.ini         # æ ‘è“æ´¾
cat /etc/frp/frps.ini         # é˜¿é‡Œäº‘æœåŠ¡å™¨
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### Q1ï¼šæ— æ³•è®¿é—® piowncloud.com

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥DNSè§£æ
nslookup piowncloud.com
# åº”è¯¥è¿”å›é˜¿é‡Œäº‘æœåŠ¡å™¨IP

# 2. æ£€æŸ¥é˜¿é‡Œäº‘æœåŠ¡å™¨FRPè¿è¡Œ
ssh root@æœåŠ¡å™¨IP
systemctl status frps
# åº”è¯¥æ˜¯ active (running)

# 3. æ£€æŸ¥æ ‘è“æ´¾FRPè¿æ¥
ssh pi@æ ‘è“æ´¾IP
sudo systemctl status frpc
sudo journalctl -u frpc -n 50
# æŸ¥çœ‹æ˜¯å¦æœ‰ "login to server success"

# 4. æ£€æŸ¥é˜²ç«å¢™
# ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°ï¼Œç¡®è®¤80ã€443ç«¯å£å·²å¼€æ”¾
```

### Q2ï¼šFRPå®¢æˆ·ç«¯æ— æ³•è¿æ¥

**ç—‡çŠ¶ï¼š**
```
[ERROR] login to server failed: EOF
```

**è§£å†³æ–¹æ³•ï¼š**

```bash
# 1. æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®
sudo nano /etc/frp/frpc.ini
# ç¡®è®¤ token = xxx ä¸æœåŠ¡ç«¯ä¸€è‡´

# 2. æ£€æŸ¥æœåŠ¡å™¨IPå’Œç«¯å£
# ç¡®è®¤ server_addr å’Œ server_port æ­£ç¡®

# 3. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping é˜¿é‡Œäº‘æœåŠ¡å™¨IP
telnet é˜¿é‡Œäº‘æœåŠ¡å™¨IP 7000

# 4. é‡å¯æœåŠ¡
sudo systemctl restart frpc
```

### Q3ï¼šHTTPSè¯ä¹¦é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**

```bash
# åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Š

# 1. æ£€æŸ¥è¯ä¹¦æ˜¯å¦å­˜åœ¨
ls -la /etc/letsencrypt/live/piowncloud.com/

# 2. æ£€æŸ¥è¯ä¹¦æƒé™
chmod 755 /etc/letsencrypt/live
chmod 755 /etc/letsencrypt/archive

# 3. é‡æ–°ç”³è¯·è¯ä¹¦
systemctl stop frps
certbot certonly --standalone -d piowncloud.com --force-renew
systemctl start frps
```

### Q4ï¼šæ ‘è“æ´¾æ¢ç½‘ç»œåæ— æ³•è®¿é—®

**ç—‡çŠ¶ï¼š** æ ‘è“æ´¾è¿æ¥åˆ°æ–°ç½‘ç»œåï¼Œå¤–ç½‘æ— æ³•è®¿é—®

**è§£å†³æ–¹æ³•ï¼š**

```bash
# åœ¨æ ‘è“æ´¾ä¸Š

# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping 8.8.8.8

# 2. æ£€æŸ¥FRPçŠ¶æ€
sudo systemctl status frpc

# 3. é‡å¯FRPï¼ˆé€šå¸¸ä¼šè‡ªåŠ¨é‡è¿ï¼‰
sudo systemctl restart frpc

# 4. ç­‰å¾…30ç§’ï¼ŒæŸ¥çœ‹æ—¥å¿—
sudo journalctl -u frpc -f
# åº”è¯¥çœ‹åˆ° "login to server success"
```

### Q5ï¼šè®¿é—®é€Ÿåº¦æ…¢

**ä¼˜åŒ–å»ºè®®ï¼š**

1. **é€‰æ‹©æ›´è¿‘çš„é˜¿é‡Œäº‘åœ°åŸŸ**
   - å¦‚æœåœ¨åä¸œï¼Œé€‰åä¸œèŠ‚ç‚¹
   - é¿å…è·¨åœ°åŸŸè®¿é—®

2. **å‡çº§å¸¦å®½**
   - é˜¿é‡Œäº‘æ§åˆ¶å°å¯ä»¥ä¸´æ—¶å‡çº§å¸¦å®½
   - æŒ‰æµé‡è®¡è´¹æ›´çµæ´»

3. **å¯ç”¨å‹ç¼©**ï¼ˆåœ¨æ ‘è“æ´¾FRPé…ç½®ï¼‰

```ini
# /etc/frp/frpc.ini
[common]
server_addr = xxx
server_port = 7000
token = xxx
tcp_mux = true           # å¯ç”¨å¤šè·¯å¤ç”¨
pool_count = 5           # è¿æ¥æ± å¤§å°
```

---

## ğŸ‰ å®Œæˆï¼

æ­å–œï¼æ‚¨çš„RaspberryCloudç°åœ¨å¯ä»¥ï¼š

- âœ… é€šè¿‡ `https://piowncloud.com` ä»å…¨çƒä»»ä½•åœ°æ–¹è®¿é—®
- âœ… ä½¿ç”¨HTTPSåŠ å¯†è¿æ¥ï¼Œå®‰å…¨å¯é 
- âœ… æ ‘è“æ´¾å¯ä»¥è¿æ¥ä»»ä½•ç½‘ç»œï¼ˆWiFiã€æœ‰çº¿ã€çƒ­ç‚¹ï¼‰
- âœ… å¤–ç½‘è®¿é—®å§‹ç»ˆç¨³å®š
- âœ… æ•°æ®å®Œå…¨å­˜å‚¨åœ¨è‡ªå·±çš„æ ‘è“æ´¾ä¸Š

### æˆæœ¬æ€»ç»“

```
é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼š38-108å…ƒ/å¹´
åŸŸåï¼ˆå·²æœ‰ï¼‰ï¼š0å…ƒ
æ ‘è“æ´¾ï¼ˆå·²æœ‰ï¼‰ï¼š0å…ƒ
ç”µè´¹ï¼š~50å…ƒ/å¹´

æ€»è®¡ï¼š~88-158å…ƒ/å¹´
```

### ä¸‹ä¸€æ­¥

1. [å®‰å…¨åŠ å›º](04-å®‰å…¨åŠ å›ºæŒ‡å—.md) - å¢å¼ºç³»ç»Ÿå®‰å…¨
2. [é…ç½®è‡ªåŠ¨å¤‡ä»½](å¤‡ä»½æ¢å¤æŒ‡å—.md) - ä¿æŠ¤æ•°æ®å®‰å…¨
3. [æ€§èƒ½ä¼˜åŒ–](æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md) - æå‡è®¿é—®é€Ÿåº¦

---

## ğŸ“š é™„å½•

### é™„å½•Aï¼šæ‰‹åŠ¨å®‰è£…FRPæœåŠ¡ç«¯

å¦‚æœè‡ªåŠ¨è„šæœ¬ä¸å¯ç”¨ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨å®‰è£…ï¼š

```bash
# 1. ä¸‹è½½FRP
cd /root
wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_amd64.tar.gz

# 2. è§£å‹
tar -xzf frp_0.52.3_linux_amd64.tar.gz

# 3. åˆ›å»ºç›®å½•
mkdir -p /etc/frp
mkdir -p /var/log/frp

# 4. å¤åˆ¶æ–‡ä»¶
cp frp_0.52.3_linux_amd64/frps /usr/local/bin/
chmod +x /usr/local/bin/frps

# 5. åˆ›å»ºé…ç½®æ–‡ä»¶
nano /etc/frp/frps.ini
```

**frps.ini å†…å®¹ï¼š**

```ini
[common]
bind_port = 7000
vhost_http_port = 80
vhost_https_port = 443
dashboard_port = 7500
dashboard_user = admin
dashboard_pwd = ä½ çš„å¯†ç ï¼ˆè‡ªå·±è®¾ç½®ï¼‰
token = ä½ çš„Tokenï¼ˆéšæœºç”Ÿæˆï¼Œå¦‚ï¼šopenssl rand -hex 16ï¼‰

# æ—¥å¿—
log_file = /var/log/frp/frps.log
log_level = info
log_max_days = 3

# æ€§èƒ½ä¼˜åŒ–
max_pool_count = 50
max_ports_per_client = 0
```

**ç”ŸæˆéšæœºTokenï¼š**

```bash
openssl rand -hex 16
# è¾“å‡ºç±»ä¼¼ï¼ša1b2c3d4e5f6g7h8i9j0
# å°†è¿™ä¸ªå€¼ä½œä¸ºtoken
```

**åˆ›å»ºsystemdæœåŠ¡ï¼š**

```bash
nano /etc/systemd/system/frps.service
```

**frps.service å†…å®¹ï¼š**

```ini
[Unit]
Description=FRP Server Service
After=network.target

[Service]
Type=simple
User=root
Restart=on-failure
RestartSec=10s
ExecStart=/usr/local/bin/frps -c /etc/frp/frps.ini

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨æœåŠ¡ï¼š**

```bash
systemctl daemon-reload
systemctl enable frps
systemctl start frps
systemctl status frps
```

### é™„å½•Bï¼šæ‰‹åŠ¨å®‰è£…FRPå®¢æˆ·ç«¯ï¼ˆæ ‘è“æ´¾ï¼‰

```bash
# 1. ä¸‹è½½FRPï¼ˆARM64ç‰ˆæœ¬ï¼‰
cd ~
wget https://github.com/fatedier/frp/releases/download/v0.52.3/frp_0.52.3_linux_arm64.tar.gz

# 2. è§£å‹
tar -xzf frp_0.52.3_linux_arm64.tar.gz

# 3. åˆ›å»ºç›®å½•
sudo mkdir -p /etc/frp

# 4. å¤åˆ¶æ–‡ä»¶
sudo cp frp_0.52.3_linux_arm64/frpc /usr/local/bin/
sudo chmod +x /usr/local/bin/frpc

# 5. åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/frp/frpc.ini
```

**frpc.ini å†…å®¹ï¼š**

```ini
[common]
server_addr = ä½ çš„é˜¿é‡Œäº‘æœåŠ¡å™¨IP
server_port = 7000
token = ä½ çš„Tokenï¼ˆä¸æœåŠ¡ç«¯ç›¸åŒï¼‰

# æ€§èƒ½ä¼˜åŒ–
tcp_mux = true
pool_count = 5

[raspberrycloud-http]
type = http
local_ip = 127.0.0.1
local_port = 80
custom_domains = piowncloud.com

[raspberrycloud-https]
type = https
local_ip = 127.0.0.1
local_port = 443
custom_domains = piowncloud.com
```

**åˆ›å»ºsystemdæœåŠ¡ï¼š**

```bash
sudo nano /etc/systemd/system/frpc.service
```

**frpc.service å†…å®¹ï¼š**

```ini
[Unit]
Description=FRP Client Service
After=network.target

[Service]
Type=simple
User=pi
Restart=on-failure
RestartSec=10s
ExecStart=/usr/local/bin/frpc -c /etc/frp/frpc.ini

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨æœåŠ¡ï¼š**

```bash
sudo systemctl daemon-reload
sudo systemctl enable frpc
sudo systemctl start frpc
sudo systemctl status frpc
```

### é™„å½•Cï¼šç›‘æ§è„šæœ¬

åˆ›å»ºç›‘æ§è„šæœ¬ï¼Œè‡ªåŠ¨æ£€æŸ¥FRPçŠ¶æ€å¹¶é‡å¯ï¼š

```bash
sudo nano /opt/raspberrycloud/scripts/monitor_frpc.sh
```

**å†…å®¹ï¼š**

```bash
#!/bin/bash
# FRPå®¢æˆ·ç«¯ç›‘æ§è„šæœ¬

LOG_FILE="/var/log/frpc_monitor.log"

# æ£€æŸ¥FRPæ˜¯å¦è¿è¡Œ
if ! systemctl is-active --quiet frpc; then
    echo "[$(date)] FRPå®¢æˆ·ç«¯æœªè¿è¡Œï¼Œæ­£åœ¨é‡å¯..." >> $LOG_FILE
    systemctl restart frpc
    sleep 5
    
    if systemctl is-active --quiet frpc; then
        echo "[$(date)] FRPå®¢æˆ·ç«¯é‡å¯æˆåŠŸ" >> $LOG_FILE
    else
        echo "[$(date)] FRPå®¢æˆ·ç«¯é‡å¯å¤±è´¥ï¼" >> $LOG_FILE
    fi
else
    echo "[$(date)] FRPå®¢æˆ·ç«¯è¿è¡Œæ­£å¸¸" >> $LOG_FILE
fi
```

**è®¾ç½®æ‰§è¡Œæƒé™ï¼š**

```bash
sudo chmod +x /opt/raspberrycloud/scripts/monitor_frpc.sh
```

**æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼š**

```bash
crontab -e

# æ·»åŠ ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
*/5 * * * * /opt/raspberrycloud/scripts/monitor_frpc.sh
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   # é˜¿é‡Œäº‘æœåŠ¡å™¨
   tail -f /var/log/frp/frps.log
   
   # æ ‘è“æ´¾
   sudo journalctl -u frpc -f
   ```

2. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   # æµ‹è¯•åˆ°é˜¿é‡Œäº‘çš„è¿æ¥
   ping é˜¿é‡Œäº‘æœåŠ¡å™¨IP
   telnet é˜¿é‡Œäº‘æœåŠ¡å™¨IP 7000
   ```

3. **é‡å¯æ‰€æœ‰æœåŠ¡**
   ```bash
   # é˜¿é‡Œäº‘
   systemctl restart frps
   
   # æ ‘è“æ´¾
   sudo systemctl restart frpc
   sudo systemctl restart raspberrycloud
   sudo systemctl restart nginx
   ```

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰


























