# 阿里云域名购买与配置详细步骤

## 📦 第一部分：在阿里云购买域名

### 步骤1：注册/登录阿里云账号

1. **访问阿里云官网**
   - 打开浏览器，访问：https://www.aliyun.com

2. **注册账号**
   - 点击右上角"登录" → "免费注册"
   - 填写手机号、验证码、密码
   - 完成注册

3. **实名认证**
   - 登录后，点击右上角头像 → "实名认证"
   - 选择"个人认证"或"企业认证"
   - 上传身份证照片
   - 等待审核（通常几分钟到几小时）

### 步骤2：购买域名

1. **进入域名注册页面**
   - 登录后，在顶部搜索框输入"域名"
   - 或直接访问：https://wanwang.aliyun.com

2. **搜索域名**
   - 在搜索框输入想要的域名（如：`mycloud`）
   - 点击"查域名"

3. **选择域名**
   - 查看可用的域名后缀和价格
   - 推荐选择：
     - `.com` - 国际通用，约50-100元/年
     - `.top` - 价格便宜，约10-20元/年
     - `.xyz` - 价格便宜，约10-20元/年
   - 点击"加入清单"

4. **结算**
   - 选择购买年限（建议1-3年）
   - 点击"立即结算"
   - 填写域名信息：
     - 域名所有者：你的姓名
     - 域名所有者类型：个人
     - 联系人信息：手机、邮箱
   - 选择支付方式并完成支付

5. **完成实名认证**
   - 购买后，进入"域名控制台"
   - 找到购买的域名
   - 如果显示"未实名认证"，点击"实名认证"
   - 上传身份证照片
   - 等待审核（1-3个工作日）

## 🌐 第二部分：配置域名解析

### 步骤1：获取树莓派公网IP

在树莓派上执行：

```bash
# 获取公网IP
curl ip.sb

# 记录这个IP，例如: 123.45.67.89
```

### 步骤2：在阿里云配置DNS解析

1. **进入DNS解析控制台**
   - 登录阿里云控制台
   - 点击"产品与服务" → "域名" → "域名解析DNS"
   - 或直接访问：https://dns.console.aliyun.com

2. **找到你的域名**
   - 在域名列表中，找到你购买的域名
   - 点击"解析设置"

3. **添加A记录（主域名）**
   - 点击"添加记录"
   - 填写信息：
     - **记录类型**: A
     - **主机记录**: @（表示主域名）
     - **记录值**: 你的公网IP（如：123.45.67.89）
     - **TTL**: 600（10分钟）
   - 点击"确认"

4. **添加A记录（www子域名）**
   - 再次点击"添加记录"
   - 填写信息：
     - **记录类型**: A
     - **主机记录**: www
     - **记录值**: 你的公网IP（同上）
     - **TTL**: 600
   - 点击"确认"

5. **等待DNS生效**
   - DNS解析通常5-30分钟生效
   - 验证解析：
     ```bash
     nslookup mycloud.com
     # 应该返回你的公网IP
     ```

## 🔧 第三部分：配置树莓派

### 步骤1：使用自动化脚本（推荐）

```bash
# 在树莓派上执行
cd ~/Desktop/Github/RaspiOwnCloud
chmod +x scripts/setup_aliyun_domain.sh
sudo bash scripts/setup_aliyun_domain.sh
```

脚本会引导你完成所有配置。

### 步骤2：手动配置（如果脚本失败）

#### 2.1 修改Nginx配置

```bash
sudo nano /etc/nginx/sites-available/raspberrycloud
```

修改 `server_name`：

```nginx
server_name mycloud.com www.mycloud.com;  # 替换为你的域名
```

#### 2.2 配置路由器端口转发

登录路由器管理页面，添加端口转发规则：

| 外部端口 | 内部IP | 内部端口 | 协议 |
|---------|--------|---------|------|
| 80 | 树莓派IP | 80 | TCP |
| 443 | 树莓派IP | 443 | TCP |

#### 2.3 申请SSL证书

```bash
# 安装Certbot
sudo apt install -y certbot python3-certbot-nginx

# 申请证书
sudo certbot --nginx -d mycloud.com -d www.mycloud.com

# 按提示操作：
# 1. 输入邮箱
# 2. 同意条款 (A)
# 3. 不接收邮件 (N)
# 4. 重定向HTTP到HTTPS (2)
```

## ✅ 第四部分：验证配置

### 验证DNS解析

```bash
nslookup mycloud.com
# 应该返回你的公网IP
```

### 验证网站访问

1. **使用手机4G网络**（关闭WiFi）
2. **浏览器访问**: `https://mycloud.com`
3. **检查**：
   - 地址栏有锁图标 🔒
   - 可以正常登录和使用

## 📋 完整检查清单

- [ ] 阿里云账号已注册并实名认证
- [ ] 域名已购买
- [ ] 域名已实名认证
- [ ] DNS解析已配置（A记录）
- [ ] 路由器端口转发已配置
- [ ] Nginx配置已更新
- [ ] SSL证书已申请
- [ ] 防火墙规则已更新
- [ ] 外网访问测试成功

## 🎉 完成！

现在你可以通过 `https://mycloud.com` 从任何地方访问你的私有云存储了！








