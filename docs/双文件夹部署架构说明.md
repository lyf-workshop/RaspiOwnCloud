# åŒæ–‡ä»¶å¤¹éƒ¨ç½²æ¶æ„è¯´æ˜

æœ¬é¡¹ç›®é‡‡ç”¨**åŒæ–‡ä»¶å¤¹éƒ¨ç½²æ¶æ„**ï¼Œè¿™æ˜¯ç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µã€‚

## ğŸ“ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ›´æ–°æ–‡ä»¶å¤¹ï¼ˆå¼€å‘ç›®å½•ï¼‰                                    â”‚
â”‚  ~/Desktop/Github/RaspiOwnCloud/                        â”‚
â”‚                                                         â”‚
â”‚  â”œâ”€â”€ .git/              â† Gitä»“åº“                       â”‚
â”‚  â”œâ”€â”€ backend/           â† åç«¯ä»£ç                       â”‚
â”‚  â”œâ”€â”€ frontend/          â† å‰ç«¯ä»£ç                       â”‚
â”‚  â”œâ”€â”€ config/            â† é…ç½®æ¨¡æ¿                      â”‚
â”‚  â”œâ”€â”€ scripts/           â† éƒ¨ç½²è„šæœ¬                      â”‚
â”‚  â””â”€â”€ docs/              â† æ–‡æ¡£                          â”‚
â”‚                                                         â”‚
â”‚  ç”¨é€”ï¼šä»GitHubä¸‹è½½å’Œæ›´æ–°ä»£ç                             â”‚
â”‚  æƒé™ï¼šæ™®é€šç”¨æˆ·ï¼ˆpiï¼‰å¯è¯»å†™                              â”‚
â”‚  æ“ä½œï¼šgit pull, git status, ä»£ç ä¿®æ”¹                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
              bash scripts/quick_update.sh
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿäº§æ–‡ä»¶å¤¹ï¼ˆè¿è¡Œç›®å½•ï¼‰                                    â”‚
â”‚  /opt/raspberrycloud/                                   â”‚
â”‚                                                         â”‚
â”‚  â”œâ”€â”€ backend/           â† åç«¯ä»£ç ï¼ˆè¿è¡Œç‰ˆæœ¬ï¼‰            â”‚
â”‚  â”‚   â”œâ”€â”€ main.py                                       â”‚
â”‚  â”‚   â”œâ”€â”€ .env          â† ç¯å¢ƒé…ç½®ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰            â”‚
â”‚  â”‚   â””â”€â”€ ...                                           â”‚
â”‚  â”œâ”€â”€ venv/              â† Pythonè™šæ‹Ÿç¯å¢ƒ                â”‚
â”‚  â”œâ”€â”€ config/            â† é…ç½®æ–‡ä»¶                      â”‚
â”‚  â”œâ”€â”€ scripts/           â† è„šæœ¬æ–‡ä»¶                      â”‚
â”‚  â””â”€â”€ docs/              â† æ–‡æ¡£                          â”‚
â”‚                                                         â”‚
â”‚  ç”¨é€”ï¼šå®é™…è¿è¡Œçš„æœåŠ¡ä»£ç                                  â”‚
â”‚  æƒé™ï¼šwww-dataç”¨æˆ·ï¼ˆæœåŠ¡è¿è¡Œèº«ä»½ï¼‰                       â”‚
â”‚  æ“ä½œï¼šsystemdæœåŠ¡è¯»å–è¿è¡Œ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ ä¸ºä»€ä¹ˆä½¿ç”¨åŒæ–‡ä»¶å¤¹ï¼Ÿ

### ä¼˜åŠ¿

1. **æƒé™åˆ†ç¦»ï¼Œæ›´å®‰å…¨**
   - æ›´æ–°æ–‡ä»¶å¤¹ï¼šæ™®é€šç”¨æˆ·æƒé™ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨Git
   - ç”Ÿäº§æ–‡ä»¶å¤¹ï¼šwww-dataæƒé™ï¼ŒæœåŠ¡è¿è¡Œæ›´å®‰å…¨

2. **æ›´æ–°ä¸å½±å“è¿è¡Œ**
   - åœ¨æ›´æ–°æ–‡ä»¶å¤¹æ‹‰å–ä»£ç ä¸ä¼šå½±å“æ­£åœ¨è¿è¡Œçš„æœåŠ¡
   - å¯ä»¥å…ˆæµ‹è¯•ä»£ç ï¼Œç¡®è®¤æ— è¯¯åå†éƒ¨ç½²

3. **é¿å…Gitæƒé™é—®é¢˜**
   - ä¸éœ€è¦åœ¨ç”Ÿäº§ç›®å½•ä½¿ç”¨Gitï¼Œé¿å…æƒé™å†²çª
   - ä¸ä¼šå‡ºç°"unsafe repository"é”™è¯¯

4. **æ¸…æ™°çš„å·¥ä½œæµç¨‹**
   - å¼€å‘/æ›´æ–°ï¼šåœ¨æ›´æ–°æ–‡ä»¶å¤¹æ“ä½œ
   - éƒ¨ç½²ï¼šè¿è¡Œè„šæœ¬è‡ªåŠ¨å¤åˆ¶åˆ°ç”Ÿäº§æ–‡ä»¶å¤¹
   - è¿è¡Œï¼šæœåŠ¡ä»ç”Ÿäº§æ–‡ä»¶å¤¹è¯»å–

## ğŸ“‚ æ–‡ä»¶å¤¹è¯¦ç»†è¯´æ˜

### æ›´æ–°æ–‡ä»¶å¤¹ï¼š`~/Desktop/Github/RaspiOwnCloud/`

**ä½ç½®**ï¼šç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼Œé€šå¸¸æ˜¯ `/home/pi/Desktop/Github/RaspiOwnCloud/`

**æƒé™**ï¼š
```bash
æ‰€æœ‰è€…ï¼špi:piï¼ˆæˆ–å½“å‰ç”¨æˆ·ï¼‰
æƒé™ï¼š755ï¼ˆç”¨æˆ·å¯è¯»å†™æ‰§è¡Œï¼‰
```

**ç”¨é€”**ï¼š
- ä»GitHubå…‹éš†å’Œæ‹‰å–æœ€æ–°ä»£ç 
- æŸ¥çœ‹ä»£ç å†å²å’Œæäº¤è®°å½•
- ä¿®æ”¹å’Œæµ‹è¯•ä»£ç 
- ä½œä¸ºéƒ¨ç½²çš„æºç›®å½•

**å¸¸ç”¨æ“ä½œ**ï¼š
```bash
cd ~/Desktop/Github/RaspiOwnCloud

# Gitæ“ä½œ
git pull origin main
git status
git log

# éƒ¨ç½²åˆ°ç”Ÿäº§
bash scripts/quick_update.sh
```

### ç”Ÿäº§æ–‡ä»¶å¤¹ï¼š`/opt/raspberrycloud/`

**ä½ç½®**ï¼šç³»ç»Ÿçº§åº”ç”¨ç›®å½• `/opt/raspberrycloud/`

**æƒé™**ï¼š
```bash
æ‰€æœ‰è€…ï¼šwww-data:www-data
æƒé™ï¼š755
```

**ç”¨é€”**ï¼š
- systemdæœåŠ¡ä»è¿™é‡Œè¯»å–ä»£ç è¿è¡Œ
- åŒ…å«Pythonè™šæ‹Ÿç¯å¢ƒ
- åŒ…å«æ•æ„Ÿé…ç½®æ–‡ä»¶ï¼ˆ.envï¼‰
- å®é™…çš„ç”Ÿäº§è¿è¡Œç¯å¢ƒ

**é‡è¦æ–‡ä»¶**ï¼š
```
/opt/raspberrycloud/
â”œâ”€â”€ backend/.env        â† ç¯å¢ƒé…ç½®ï¼ˆæ•°æ®åº“å¯†ç ç­‰ï¼‰
â”œâ”€â”€ venv/               â† Pythonè™šæ‹Ÿç¯å¢ƒ
â””â”€â”€ backend/raspberrycloud.db  â† æ•°æ®åº“æ–‡ä»¶ï¼ˆSQLiteï¼‰
```

**æ³¨æ„äº‹é¡¹**ï¼š
- âš ï¸ ä¸è¦åœ¨è¿™é‡Œä½¿ç”¨Gitå‘½ä»¤
- âš ï¸ ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ä»£ç ï¼ˆåº”åœ¨æ›´æ–°æ–‡ä»¶å¤¹ä¿®æ”¹åéƒ¨ç½²ï¼‰
- âš ï¸ é…ç½®æ–‡ä»¶ï¼ˆ.envï¼‰ä¸ä¼šè¢«æ›´æ–°è„šæœ¬è¦†ç›–

## ğŸš€ å®Œæ•´å·¥ä½œæµç¨‹

### é¦–æ¬¡éƒ¨ç½²

```bash
# 1. åˆ›å»ºæ›´æ–°æ–‡ä»¶å¤¹å¹¶å…‹éš†é¡¹ç›®
mkdir -p ~/Desktop/Github
cd ~/Desktop/Github
git clone https://github.com/lyf-workshop/RaspiOwnCloud.git
cd RaspiOwnCloud

# 2. è¿è¡Œåˆå§‹éƒ¨ç½²è„šæœ¬
sudo bash scripts/initial_deploy.sh

# 3. ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo nano /opt/raspberrycloud/backend/.env

# 4. åˆå§‹åŒ–æ•°æ®åº“
cd /opt/raspberrycloud/backend
sudo -u www-data bash -c 'source ../venv/bin/activate && python -c "from models import init_db; init_db()"'

# 5. é‡å¯æœåŠ¡
sudo systemctl restart raspberrycloud
```

### æ—¥å¸¸æ›´æ–°æµç¨‹

```bash
# 1. è¿›å…¥æ›´æ–°æ–‡ä»¶å¤¹
cd ~/Desktop/Github/RaspiOwnCloud

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. å¿«é€Ÿéƒ¨ç½²åˆ°ç”Ÿäº§ï¼ˆè‡ªåŠ¨åœæ­¢æœåŠ¡ã€å¤åˆ¶æ–‡ä»¶ã€é‡å¯æœåŠ¡ï¼‰
bash scripts/quick_update.sh
```

### å®Œæ•´æ›´æ–°æµç¨‹ï¼ˆå¸¦å¤‡ä»½ï¼‰

```bash
# 1. è¿›å…¥æ›´æ–°æ–‡ä»¶å¤¹
cd ~/Desktop/Github/RaspiOwnCloud

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. å®Œæ•´æ›´æ–°ï¼ˆåŒ…å«å¤‡ä»½ã€ä¾èµ–æ›´æ–°ï¼‰
sudo bash scripts/update_from_github.sh
```

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€
sudo systemctl status raspberrycloud

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u raspberrycloud -f

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
sudo journalctl -u raspberrycloud -n 50
```

### é‡å¯æœåŠ¡

```bash
sudo systemctl restart raspberrycloud
```

### æŸ¥çœ‹ä»£ç ç‰ˆæœ¬

```bash
# æŸ¥çœ‹æ›´æ–°æ–‡ä»¶å¤¹çš„ç‰ˆæœ¬
cd ~/Desktop/Github/RaspiOwnCloud
git log -1

# æŸ¥çœ‹ç”Ÿäº§æ–‡ä»¶å¤¹çš„æ–‡ä»¶ä¿®æ”¹æ—¶é—´
ls -lt /opt/raspberrycloud/backend/main.py
```

### ä¿®æ”¹é…ç½®

```bash
# ç¼–è¾‘ç¯å¢ƒé…ç½®
sudo nano /opt/raspberrycloud/backend/.env

# ä¿®æ”¹åé‡å¯æœåŠ¡
sudo systemctl restart raspberrycloud
```

### å¤‡ä»½ç”Ÿäº§æ•°æ®

```bash
# å¤‡ä»½æ•´ä¸ªç”Ÿäº§ç›®å½•
sudo cp -r /opt/raspberrycloud /opt/raspberrycloud_backup_$(date +%Y%m%d)

# ä»…å¤‡ä»½æ•°æ®åº“
sudo cp /opt/raspberrycloud/backend/raspberrycloud.db ~/backup_$(date +%Y%m%d).db
```

## ğŸ“ è„šæœ¬è¯´æ˜

### `initial_deploy.sh` - åˆå§‹éƒ¨ç½²è„šæœ¬

**ç”¨é€”**ï¼šé¦–æ¬¡éƒ¨ç½²æ—¶ä½¿ç”¨

**åŠŸèƒ½**ï¼š
- åˆ›å»ºç”Ÿäº§ç›®å½•ç»“æ„
- ä»æ›´æ–°æ–‡ä»¶å¤¹å¤åˆ¶æ‰€æœ‰æ–‡ä»¶
- åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
- å®‰è£…ä¾èµ–
- é…ç½®systemdæœåŠ¡
- é…ç½®Nginx

**ä½¿ç”¨**ï¼š
```bash
cd ~/Desktop/Github/RaspiOwnCloud
sudo bash scripts/initial_deploy.sh
```

### `quick_update.sh` - å¿«é€Ÿæ›´æ–°è„šæœ¬

**ç”¨é€”**ï¼šæ—¥å¸¸å¿«é€Ÿæ›´æ–°ï¼ˆæ¨èï¼‰

**åŠŸèƒ½**ï¼š
- ä»æ›´æ–°æ–‡ä»¶å¤¹å¤åˆ¶ä»£ç åˆ°ç”Ÿäº§æ–‡ä»¶å¤¹
- é‡å¯æœåŠ¡
- ä¸å¤‡ä»½ã€ä¸æ›´æ–°ä¾èµ–ï¼ˆé€Ÿåº¦å¿«ï¼‰

**ä½¿ç”¨**ï¼š
```bash
cd ~/Desktop/Github/RaspiOwnCloud
bash scripts/quick_update.sh
```

### `update_from_github.sh` - å®Œæ•´æ›´æ–°è„šæœ¬

**ç”¨é€”**ï¼šé‡å¤§æ›´æ–°æ—¶ä½¿ç”¨

**åŠŸèƒ½**ï¼š
- å¤‡ä»½å½“å‰ç”Ÿäº§ç‰ˆæœ¬
- ä»æ›´æ–°æ–‡ä»¶å¤¹å¤åˆ¶ä»£ç 
- æ›´æ–°Pythonä¾èµ–
- æ›´æ–°é…ç½®æ–‡ä»¶
- é‡å¯æœåŠ¡

**ä½¿ç”¨**ï¼š
```bash
cd ~/Desktop/Github/RaspiOwnCloud
sudo bash scripts/update_from_github.sh
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é…ç½®æ–‡ä»¶ä¿æŠ¤

æ›´æ–°è„šæœ¬ä¼šè‡ªåŠ¨ä¿æŠ¤ä»¥ä¸‹æ–‡ä»¶ï¼Œä¸ä¼šè¦†ç›–ï¼š
- `/opt/raspberrycloud/backend/.env` - ç¯å¢ƒé…ç½®
- `/opt/raspberrycloud/backend/raspberrycloud.db` - æ•°æ®åº“æ–‡ä»¶

### 2. æƒé™ç®¡ç†

- æ›´æ–°æ–‡ä»¶å¤¹ï¼šæ™®é€šç”¨æˆ·æƒé™å³å¯
- ç”Ÿäº§æ–‡ä»¶å¤¹ï¼šå¿…é¡»ä½¿ç”¨sudoæ“ä½œ
- æœåŠ¡è¿è¡Œï¼šä»¥www-dataç”¨æˆ·èº«ä»½è¿è¡Œ

### 3. Gitæ“ä½œ

- âœ… åœ¨æ›´æ–°æ–‡ä»¶å¤¹ä½¿ç”¨Gitå‘½ä»¤
- âŒ ä¸è¦åœ¨ç”Ÿäº§æ–‡ä»¶å¤¹ä½¿ç”¨Gitå‘½ä»¤

### 4. ä»£ç ä¿®æ”¹

- âœ… åœ¨æ›´æ–°æ–‡ä»¶å¤¹ä¿®æ”¹ä»£ç 
- âœ… æµ‹è¯•åè¿è¡Œéƒ¨ç½²è„šæœ¬
- âŒ ä¸è¦ç›´æ¥ä¿®æ”¹ç”Ÿäº§æ–‡ä»¶å¤¹çš„ä»£ç 

## ğŸ” æ•…éšœæ’æŸ¥

### æ›´æ–°æ–‡ä»¶å¤¹ä¸å­˜åœ¨

```bash
# åˆ›å»ºå¹¶å…‹éš†
mkdir -p ~/Desktop/Github
cd ~/Desktop/Github
git clone https://github.com/lyf-workshop/RaspiOwnCloud.git
```

### ç”Ÿäº§æ–‡ä»¶å¤¹æƒé™é”™è¯¯

```bash
# ä¿®å¤æƒé™
sudo chown -R www-data:www-data /opt/raspberrycloud
sudo chmod -R 755 /opt/raspberrycloud
```

### æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u raspberrycloud -n 100 --no-pager

# æ£€æŸ¥é…ç½®æ–‡ä»¶
sudo nano /opt/raspberrycloud/backend/.env

# æ£€æŸ¥Pythonä¾èµ–
cd /opt/raspberrycloud/backend
sudo -u www-data bash -c 'source ../venv/bin/activate && pip list'
```

### æ›´æ–°åæœåŠ¡å¼‚å¸¸

```bash
# å›æ»šåˆ°å¤‡ä»½ç‰ˆæœ¬
sudo systemctl stop raspberrycloud
sudo cp -r /opt/raspberrycloud_backup_YYYYMMDD/* /opt/raspberrycloud/
sudo systemctl start raspberrycloud
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿéƒ¨ç½²æ•™ç¨‹](02-ç³»ç»Ÿéƒ¨ç½²æ•™ç¨‹.md) - è¯¦ç»†éƒ¨ç½²æ­¥éª¤
- [é—®é¢˜æ’æŸ¥æ‰‹å†Œ](05-é—®é¢˜æ’æŸ¥æ‰‹å†Œ.md) - å¸¸è§é—®é¢˜è§£å†³
- [å®‰å…¨åŠ å›ºæŒ‡å—](04-å®‰å…¨åŠ å›ºæŒ‡å—.md) - å®‰å…¨é…ç½®

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**
   ```bash
   # æ¯å‘¨å¤‡ä»½ä¸€æ¬¡ç”Ÿäº§æ•°æ®
   sudo cp -r /opt/raspberrycloud /opt/raspberrycloud_backup_$(date +%Y%m%d)
   ```

2. **æµ‹è¯•åéƒ¨ç½²**
   - åœ¨æ›´æ–°æ–‡ä»¶å¤¹æµ‹è¯•æ–°åŠŸèƒ½
   - ç¡®è®¤æ— è¯¯åå†éƒ¨ç½²åˆ°ç”Ÿäº§

3. **æŸ¥çœ‹æ›´æ–°æ—¥å¿—**
   ```bash
   cd ~/Desktop/Github/RaspiOwnCloud
   git log --oneline -10
   ```

4. **ä¿æŒæ›´æ–°**
   ```bash
   # æ¯å‘¨æ£€æŸ¥æ›´æ–°
   cd ~/Desktop/Github/RaspiOwnCloud
   git fetch origin
   git log HEAD..origin/main
   ```


